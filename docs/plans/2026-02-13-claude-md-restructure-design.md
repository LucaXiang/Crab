# CLAUDE.md 重构设计

## 目标

1. 根 CLAUDE.md 从 216 行 / 11.2KB 瘦身到 ~65 行 / ~3.5KB，减少每次对话的 context 开销
2. 消除跨文件冗余（类型对齐、金额约束、Tauri 参数等在 3 处重复）
3. 建立按需加载索引，详细规范拆到 `docs/claude/` 主题文件

## 方案：按需索引 + 去重

### 根 CLAUDE.md 新结构（~65 行）

保留（每次对话必须知道）：
- 项目简介 + 开发阶段声明（3 行）
- Workspace 成员索引表（10 行）
- 常用命令（12 行）
- 架构关系文字描述（5 行，替代 20 行 ASCII art）
- 禁止事项 12 条（14 行）— 红线不可拆
- 修复原则（2 行）— 红线
- 提交规范（3 行）
- 执行风格（4 行）
- 按需加载索引区（10 行）
- 响应语言（1 行）

移除（拆到 docs/claude/）：
- 核心架构 ASCII art
- 全栈统一约定表
- 架构原则表
- 类型对齐详细说明
- 测试规范
- Schema 变更工作流
- 日志规范（50+ 行，收益最大）

### docs/claude/ 主题文件

| 文件 | 来源 | 触发条件 |
|------|------|----------|
| `conventions.md` | 根 §全栈统一约定 + §架构原则 + §类型对齐 | 修改跨前后端类型、添加约定 |
| `logging.md` | 根 §日志规范 全文 | 编写或审查 tracing 日志 |
| `testing.md` | 根 §测试规范 | 编写测试代码 |
| `schema-workflow.md` | 根 §Schema 变更工作流 | 修改数据库 schema |

### 子 crate CLAUDE.md 去重

| 文件 | 操作 |
|------|------|
| `red_coral/CLAUDE.md` | §关键约束 移除与根重复的条目 → 改为引用 `docs/claude/conventions.md` |
| `shared/CLAUDE.md` | §类型对齐 移除重复约定说明 |
| 其他 5 个 crate | 不动（已精简，无冗余） |

### 预期效果

| 指标 | 改前 | 改后 |
|------|------|------|
| 根 CLAUDE.md | 216 行 / 11.2KB | ~65 行 / ~3.5KB |
| 每次对话 context 节省 | - | ~7.7KB（减 70%） |
| 总文件数 | 9 | 13（+4 主题文件） |
| 跨文件冗余 | 多处重复 | 单一真相源 |
