{"schemas":"-- Archive Verification Schema\n-- 归档哈希链验证记录表（由 VerifyScheduler 自动写入）\n\nDEFINE TABLE OVERWRITE archive_verification TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select WHERE $auth.role = role:admin OR $auth.id = employee:admin\n        FOR create FULL\n        FOR update, delete NONE;\n\n-- 验证类型\nDEFINE FIELD OVERWRITE verification_type ON archive_verification TYPE string\n    PERMISSIONS FULL;\n\n-- 营业日标签 (daily: \"2026-01-29\", full: None)\nDEFINE FIELD OVERWRITE date ON archive_verification TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 订单统计\nDEFINE FIELD OVERWRITE total_orders ON archive_verification TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE verified_orders ON archive_verification TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 链路完整性\nDEFINE FIELD OVERWRITE chain_intact ON archive_verification TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- 异常计数\nDEFINE FIELD OVERWRITE chain_resets_count ON archive_verification TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE chain_breaks_count ON archive_verification TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE invalid_orders_count ON archive_verification TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 有异常时存储完整验证结果 JSON\nDEFINE FIELD OVERWRITE details ON archive_verification TYPE option<object>\n    PERMISSIONS FULL;\n\n-- 时间戳（自动生成，只读）\nDEFINE FIELD OVERWRITE created_at ON archive_verification TYPE int READONLY\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 索引\nDEFINE INDEX OVERWRITE av_type_idx ON archive_verification FIELDS verification_type;\nDEFINE INDEX OVERWRITE av_date_idx ON archive_verification FIELDS date;\nDEFINE INDEX OVERWRITE av_created_idx ON archive_verification FIELDS created_at;\nDEFINE INDEX OVERWRITE av_intact_idx ON archive_verification FIELDS chain_intact;\n-- Fix #3: 去重约束（同类型+同日期只保留一条）\nDEFINE INDEX OVERWRITE av_type_date_unique ON archive_verification FIELDS verification_type, date UNIQUE;\n\n-- Attribute Schema (Graph-oriented)\n-- 属性表，选项直接嵌入，使用 RELATE 建立与产品/分类的关系\n\nDEFINE TABLE OVERWRITE attribute TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON attribute TYPE string\n    PERMISSIONS FULL;\n\n-- 选择模式\nDEFINE FIELD OVERWRITE is_multi_select ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- 多选上限 (null = 无限)\nDEFINE FIELD OVERWRITE max_selections ON attribute TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 默认选项索引 (支持多选)\nDEFINE FIELD OVERWRITE default_option_indices ON attribute TYPE option<array<int>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_order ON attribute TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON attribute TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE show_on_receipt ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE receipt_name ON attribute TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 厨打设置\nDEFINE FIELD OVERWRITE show_on_kitchen_print ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE kitchen_print_name ON attribute TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 选项直接嵌入 (Graph DB 风格: 减少 JOIN)\n-- options: [{ name: \"微辣\", price_modifier: 0, kitchen_print_name: null }, ...]\nDEFINE FIELD OVERWRITE options ON attribute TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE options.*.name ON attribute TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE options.*.price_modifier ON attribute TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE options.*.display_order ON attribute TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE options.*.is_active ON attribute TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE options.*.receipt_name ON attribute TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE options.*.kitchen_print_name ON attribute TYPE option<string>\n    PERMISSIONS FULL;\n\n-- Quantity control for option\nDEFINE FIELD OVERWRITE options.*.enable_quantity ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE options.*.max_quantity ON attribute TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE attr_order ON attribute FIELDS display_order;\n\n-- =============================================================================\n-- 边关系: has_attribute (产品/分类 -> 属性)\n-- =============================================================================\n-- 使用: RELATE product:1->has_attribute->attribute:spicy SET is_required = true\n-- 查询: SELECT ->has_attribute->attribute FROM product:1\n\nDEFINE TABLE OVERWRITE has_attribute TYPE RELATION\n    FROM product | category\n    TO attribute\n    SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE is_required ON has_attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_order ON has_attribute TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 覆盖属性的默认选项索引 (支持多选)\nDEFINE FIELD OVERWRITE default_option_indices ON has_attribute TYPE option<array<int>>\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE has_attr_unique ON has_attribute FIELDS in, out UNIQUE;\n\n-- Audit Log Table Schema\n-- 税务级审计日志表，SHA256 哈希链防篡改\n-- Append-only: 不允许 update/delete\n\nDEFINE TABLE OVERWRITE audit_log TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select WHERE $auth.role = role:admin OR $auth.id = employee:admin\n        FOR create FULL\n        FOR update, delete NONE;\n\n-- 序列号（全局递增，哈希链标识）\nDEFINE FIELD OVERWRITE sequence ON audit_log TYPE int\n    PERMISSIONS FULL;\n\n-- 时间戳（Unix 毫秒）\nDEFINE FIELD OVERWRITE timestamp ON audit_log TYPE int\n    PERMISSIONS FULL;\n\n-- 操作类型（snake_case 字符串，与 Rust AuditAction 枚举对应）\nDEFINE FIELD OVERWRITE action ON audit_log TYPE string\n    PERMISSIONS FULL;\n\n-- 资源类型（如 \"system\", \"auth\", \"order\", \"employee\"）\nDEFINE FIELD OVERWRITE resource_type ON audit_log TYPE string\n    PERMISSIONS FULL;\n\n-- 资源 ID（如 \"server:main\", \"employee:emp1\"）\nDEFINE FIELD OVERWRITE resource_id ON audit_log TYPE string\n    PERMISSIONS FULL;\n\n-- 操作人 ID（系统事件为 null）\nDEFINE FIELD OVERWRITE operator_id ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 操作人名称\nDEFINE FIELD OVERWRITE operator_name ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 结构化详情（任意 JSON 对象）\nDEFINE FIELD OVERWRITE details ON audit_log FLEXIBLE TYPE object DEFAULT {}\n    PERMISSIONS FULL;\n\n-- 关联目标（可选，指向相关审计条目或资源，如 \"system_issue:xxx\"）\nDEFINE FIELD OVERWRITE target ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\n-- SHA256 哈希链 — 前一条审计日志哈希\nDEFINE FIELD OVERWRITE prev_hash ON audit_log TYPE string\n    PERMISSIONS FULL;\n\n-- SHA256 哈希链 — 当前记录哈希\nDEFINE FIELD OVERWRITE curr_hash ON audit_log TYPE string\n    PERMISSIONS FULL;\n\n-- 索引\nDEFINE INDEX OVERWRITE audit_sequence_idx ON audit_log FIELDS sequence UNIQUE;\nDEFINE INDEX OVERWRITE audit_timestamp_idx ON audit_log FIELDS timestamp;\nDEFINE INDEX OVERWRITE audit_action_idx ON audit_log FIELDS action;\nDEFINE INDEX OVERWRITE audit_operator_idx ON audit_log FIELDS operator_id;\nDEFINE INDEX OVERWRITE audit_resource_type_idx ON audit_log FIELDS resource_type;\n\n-- Category Table Schema\n-- 产品分类表\n\nDEFINE TABLE OVERWRITE category TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON category TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE sort_order ON category TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 厨房打印目的地\nDEFINE FIELD OVERWRITE kitchen_print_destinations ON category TYPE option<array<record<print_destination>>>\n    PERMISSIONS FULL;\n\n-- 标签打印目的地\nDEFINE FIELD OVERWRITE label_print_destinations ON category TYPE option<array<record<print_destination>>>\n    PERMISSIONS FULL;\n\n-- 厨房打印开关\nDEFINE FIELD OVERWRITE is_kitchen_print_enabled ON category TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- 标签打印开关\nDEFINE FIELD OVERWRITE is_label_print_enabled ON category TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- 虚拟分类支持\nDEFINE FIELD OVERWRITE is_virtual ON category TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tag_ids ON category TYPE array<record<tag>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE match_mode ON category TYPE string\n    DEFAULT 'any'\n    PERMISSIONS FULL;\n\n-- 是否在 POS 主页显示此分类\nDEFINE FIELD OVERWRITE is_display ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE category_name_unique ON category FIELDS name UNIQUE;\nDEFINE INDEX OVERWRITE category_sort_order ON category FIELDS sort_order;\n\n-- Daily Report Schema\n-- 日结报告表\n\nDEFINE TABLE OVERWRITE daily_report TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- 营业日期 (YYYY-MM-DD)\nDEFINE FIELD OVERWRITE business_date ON daily_report TYPE string\n    PERMISSIONS FULL;\n\n-- === 订单统计 ===\n\n-- 总订单数\nDEFINE FIELD OVERWRITE total_orders ON daily_report TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 完成订单数\nDEFINE FIELD OVERWRITE completed_orders ON daily_report TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 作废订单数\nDEFINE FIELD OVERWRITE void_orders ON daily_report TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- === 金额统计 ===\n\n-- 总营业额 (completed orders)\nDEFINE FIELD OVERWRITE total_sales ON daily_report TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 已支付金额\nDEFINE FIELD OVERWRITE total_paid ON daily_report TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 未支付金额\nDEFINE FIELD OVERWRITE total_unpaid ON daily_report TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 作废订单金额\nDEFINE FIELD OVERWRITE void_amount ON daily_report TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 税额总计\nDEFINE FIELD OVERWRITE total_tax ON daily_report TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 折扣总计\nDEFINE FIELD OVERWRITE total_discount ON daily_report TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 附加费总计\nDEFINE FIELD OVERWRITE total_surcharge ON daily_report TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- === 税率分类 (西班牙 IVA) ===\nDEFINE FIELD OVERWRITE tax_breakdowns ON daily_report TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax_breakdowns.*.tax_rate ON daily_report TYPE int PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE tax_breakdowns.*.net_amount ON daily_report TYPE decimal DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE tax_breakdowns.*.tax_amount ON daily_report TYPE decimal DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE tax_breakdowns.*.gross_amount ON daily_report TYPE decimal DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE tax_breakdowns.*.order_count ON daily_report TYPE int DEFAULT 0 PERMISSIONS FULL;\n\n-- === 支付方式分类 ===\nDEFINE FIELD OVERWRITE payment_breakdowns ON daily_report TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE payment_breakdowns.*.method ON daily_report TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE payment_breakdowns.*.amount ON daily_report TYPE decimal DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE payment_breakdowns.*.count ON daily_report TYPE int DEFAULT 0 PERMISSIONS FULL;\n\n-- === 生成信息 ===\n\n-- 生成时间 (Unix timestamp millis)\nDEFINE FIELD OVERWRITE generated_at ON daily_report TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 生成人 ID\nDEFINE FIELD OVERWRITE generated_by_id ON daily_report TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 生成人姓名\nDEFINE FIELD OVERWRITE generated_by_name ON daily_report TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 备注\nDEFINE FIELD OVERWRITE note ON daily_report TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 索引\nDEFINE INDEX OVERWRITE daily_report_date_unique ON daily_report FIELDS business_date UNIQUE;\n\n-- Dining Table Schema\n-- 桌台表\n\nDEFINE TABLE OVERWRITE dining_table TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON dining_table TYPE string\n    PERMISSIONS FULL;\n\n-- 区域关联\nDEFINE FIELD OVERWRITE zone ON dining_table TYPE record<zone>\n    PERMISSIONS FULL;\n\n-- 座位数\nDEFINE FIELD OVERWRITE capacity ON dining_table TYPE int\n    DEFAULT 4\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON dining_table TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE table_zone ON dining_table FIELDS zone;\nDEFINE INDEX OVERWRITE table_name_zone ON dining_table FIELDS zone, name UNIQUE;\n\n-- Employee Table Schema\n-- 员工表，存储系统用户信息\n\nDEFINE TABLE OVERWRITE employee TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE username ON employee TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE hash_pass ON employee TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_name ON employee TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE role ON employee TYPE record<role>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_system ON employee TYPE bool DEFAULT false\n    PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE is_active ON employee TYPE bool DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON employee TYPE int\n    DEFAULT time::unix(time::now()) * 1000\n    READONLY\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE username_unique ON employee FIELDS username UNIQUE;\n\n-- Image Reference Table Schema\n-- 图片引用计数表，用于跟踪图片被哪些实体引用\n\nDEFINE TABLE OVERWRITE image_ref TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- 图片哈希 (SHA256 内容哈希)\nDEFINE FIELD OVERWRITE hash ON image_ref TYPE string\n    PERMISSIONS FULL;\n\n-- 引用实体类型: \"product\", \"label_template\"\nDEFINE FIELD OVERWRITE entity_type ON image_ref TYPE string\n    PERMISSIONS FULL;\n\n-- 引用实体 ID (格式: \"product:xxx\" 或 \"label_template:xxx\")\nDEFINE FIELD OVERWRITE entity_id ON image_ref TYPE string\n    PERMISSIONS FULL;\n\n-- 创建时间 (Unix millis)\nDEFINE FIELD OVERWRITE created_at ON image_ref TYPE int\n    DEFAULT time::unix(time::now()) * 1000\n    PERMISSIONS FULL;\n\n-- 唯一索引：同一实体对同一图片只记录一次\nDEFINE INDEX OVERWRITE idx_image_ref_unique ON image_ref FIELDS hash, entity_type, entity_id UNIQUE;\n\n-- 哈希索引：快速查找图片的所有引用\nDEFINE INDEX OVERWRITE idx_image_ref_hash ON image_ref FIELDS hash;\n\n-- 实体索引：快速查找实体的所有图片引用\nDEFINE INDEX OVERWRITE idx_image_ref_entity ON image_ref FIELDS entity_type, entity_id;\n\n-- Label Template Schema\n-- 标签打印模板表\n\nDEFINE TABLE OVERWRITE label_template TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- 模板名称\nDEFINE FIELD OVERWRITE name ON label_template TYPE string\n    PERMISSIONS FULL;\n\n-- 模板描述\nDEFINE FIELD OVERWRITE description ON label_template TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 标签宽度 (mm)\nDEFINE FIELD OVERWRITE width ON label_template TYPE float\n    PERMISSIONS FULL;\n\n-- 标签高度 (mm)\nDEFINE FIELD OVERWRITE height ON label_template TYPE float\n    PERMISSIONS FULL;\n\n-- 内边距 (mm)\nDEFINE FIELD OVERWRITE padding ON label_template TYPE float\n    DEFAULT 2.0\n    PERMISSIONS FULL;\n\n-- 模板字段列表 (嵌入式数组)\nDEFINE FIELD OVERWRITE fields ON label_template TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE fields.*.id ON label_template TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.name ON label_template TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.type ON label_template TYPE string\n    PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.x ON label_template TYPE float PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.y ON label_template TYPE float PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.width ON label_template TYPE float PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.height ON label_template TYPE float PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.font_size ON label_template TYPE int DEFAULT 10 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.font_weight ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.font_family ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.color ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.rotate ON label_template TYPE option<int> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.alignment ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.data_source ON label_template TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.format ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.visible ON label_template TYPE bool DEFAULT true PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.label ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.template ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.data_key ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.source_type ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.maintain_aspect_ratio ON label_template TYPE option<bool> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.style ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.align ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.vertical_align ON label_template TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE fields.*.line_style ON label_template TYPE option<string> PERMISSIONS FULL;\n\n-- 是否默认模板\nDEFINE FIELD OVERWRITE is_default ON label_template TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- 是否启用\nDEFINE FIELD OVERWRITE is_active ON label_template TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- UI 兼容字段\nDEFINE FIELD OVERWRITE width_mm ON label_template TYPE option<float> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE height_mm ON label_template TYPE option<float> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE padding_mm_x ON label_template TYPE option<float> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE padding_mm_y ON label_template TYPE option<float> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE render_dpi ON label_template TYPE option<int> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE test_data ON label_template TYPE option<string> PERMISSIONS FULL;\n\n-- 时间戳\nDEFINE FIELD OVERWRITE created_at ON label_template TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE updated_at ON label_template TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 索引\nDEFINE INDEX OVERWRITE label_template_name_idx ON label_template FIELDS name;\nDEFINE INDEX OVERWRITE label_template_active_idx ON label_template FIELDS is_active;\n\n-- Order Schema (Graph Model)\n-- 归档订单使用图边关系，只存储核心数据\n\n-- =============================================================================\n-- order 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE receipt_number ON order TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE zone_name ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE table_name ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE status ON order TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_retail ON order TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE guest_count ON order TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE original_total ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE subtotal ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE total_amount ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE paid_amount ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE discount_amount ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE surcharge_amount ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE comp_total_amount ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE order_manual_discount_amount ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE order_manual_surcharge_amount ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE order_rule_discount_amount ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE order_rule_surcharge_amount ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax ON order TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE start_time ON order TYPE int\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE end_time ON order TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE operator_id ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE operator_name ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE void_type ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE loss_reason ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE loss_amount ON order TYPE option<decimal>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE void_note ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE related_order_id ON order TYPE option<record<order>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE prev_hash ON order TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE curr_hash ON order TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON order TYPE int\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE order_receipt ON order FIELDS receipt_number UNIQUE;\nDEFINE INDEX OVERWRITE order_status ON order FIELDS status;\nDEFINE INDEX OVERWRITE order_end_time ON order FIELDS end_time;\nDEFINE INDEX OVERWRITE order_hash ON order FIELDS curr_hash;\nDEFINE INDEX OVERWRITE order_status_end_time ON order FIELDS status, end_time;\nDEFINE INDEX OVERWRITE order_created_at ON order FIELDS created_at;\n\n-- =============================================================================\n-- order_item 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_item TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE spec ON order_item TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE instance_id ON order_item TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE name ON order_item TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE spec_name ON order_item TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE price ON order_item TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE quantity ON order_item TYPE int\n    DEFAULT 1\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE unpaid_quantity ON order_item TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE unit_price ON order_item TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE line_total ON order_item TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE discount_amount ON order_item TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE surcharge_amount ON order_item TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE rule_discount_amount ON order_item TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE rule_surcharge_amount ON order_item TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax ON order_item TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax_rate ON order_item TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE category_name ON order_item TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE applied_rules ON order_item TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE note ON order_item TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_comped ON order_item TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE order_item_spec ON order_item FIELDS spec;\nDEFINE INDEX OVERWRITE order_item_instance ON order_item FIELDS instance_id;\n\n-- =============================================================================\n-- order_item_option 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_item_option TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE attribute_name ON order_item_option TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE option_name ON order_item_option TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE price ON order_item_option TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- =============================================================================\n-- order_payment 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_payment TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE seq ON order_payment TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE payment_id ON order_payment TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE method ON order_payment TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE amount ON order_payment TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE time ON order_payment TYPE int\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE cancelled ON order_payment TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE cancel_reason ON order_payment TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE split_type ON order_payment TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE split_items ON order_payment TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE aa_shares ON order_payment TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE aa_total_shares ON order_payment TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE payment_method ON order_payment FIELDS method;\nDEFINE INDEX OVERWRITE payment_time ON order_payment FIELDS time;\n\n-- =============================================================================\n-- order_event 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_event TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE seq ON order_event TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE event_type ON order_event TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE timestamp ON order_event TYPE int\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE data ON order_event TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE prev_hash ON order_event TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE curr_hash ON order_event TYPE string\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE event_time ON order_event FIELDS timestamp;\n\n-- =============================================================================\n-- 图边关系\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE has_item TYPE RELATION\n    FROM order TO order_item SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE INDEX OVERWRITE has_item_in ON has_item FIELDS in;\n\nDEFINE TABLE OVERWRITE has_option TYPE RELATION\n    FROM order_item TO order_item_option SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE INDEX OVERWRITE has_option_in ON has_option FIELDS in;\n\nDEFINE TABLE OVERWRITE has_payment TYPE RELATION\n    FROM order TO order_payment SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE INDEX OVERWRITE has_payment_in ON has_payment FIELDS in;\n\nDEFINE TABLE OVERWRITE has_event TYPE RELATION\n    FROM order TO order_event SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE INDEX OVERWRITE has_event_in ON has_event FIELDS in;\n\n-- Payment 独立表：支付记录（从订单事件溯源投影）\n-- 归档时写入，方便统计和对账\n\nDEFINE TABLE OVERWRITE payment TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update WHERE true\n        FOR delete NONE;\n\n-- 核心字段\nDEFINE FIELD OVERWRITE payment_id    ON payment TYPE string;\nDEFINE FIELD OVERWRITE order_id      ON payment TYPE string;\nDEFINE FIELD OVERWRITE method        ON payment TYPE string;        -- CASH / CARD\nDEFINE FIELD OVERWRITE amount        ON payment TYPE decimal;\nDEFINE FIELD OVERWRITE tendered      ON payment TYPE option<decimal>; -- 现金实收\nDEFINE FIELD OVERWRITE change_amount ON payment TYPE option<decimal>; -- 找零\nDEFINE FIELD OVERWRITE note          ON payment TYPE option<string>;\n\n-- 分单上下文\nDEFINE FIELD OVERWRITE split_type    ON payment TYPE option<string>; -- ItemSplit / AmountSplit / AaSplit / null\nDEFINE FIELD OVERWRITE aa_shares     ON payment TYPE option<int>;\nDEFINE FIELD OVERWRITE split_items   ON payment TYPE option<string>; -- JSON string [{name, quantity, unit_price}]\n\n-- 操作人\nDEFINE FIELD OVERWRITE operator_id   ON payment TYPE option<string>;\nDEFINE FIELD OVERWRITE operator_name ON payment TYPE option<string>;\n\n-- 取消\nDEFINE FIELD OVERWRITE cancelled     ON payment TYPE bool DEFAULT false;\nDEFINE FIELD OVERWRITE cancel_reason ON payment TYPE option<string>;\n\n-- 时间\nDEFINE FIELD OVERWRITE timestamp     ON payment TYPE int;   -- 支付时间 (unix ms)\nDEFINE FIELD OVERWRITE created_at    ON payment TYPE int;    -- 记录创建时间\n\n-- 索引\nDEFINE INDEX OVERWRITE idx_payment_id  ON payment FIELDS payment_id UNIQUE;\nDEFINE INDEX OVERWRITE idx_order_id    ON payment FIELDS order_id;\nDEFINE INDEX OVERWRITE idx_timestamp   ON payment FIELDS timestamp;\nDEFINE INDEX OVERWRITE idx_operator    ON payment FIELDS operator_id;\n\n-- Price Rule Schema\n-- 价格调整规则（折扣/附加费）\n\nDEFINE TABLE OVERWRITE price_rule TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON price_rule TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_name ON price_rule TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE receipt_name ON price_rule TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON price_rule TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 规则类型: DISCOUNT, SURCHARGE\nDEFINE FIELD OVERWRITE rule_type ON price_rule TYPE string\n    PERMISSIONS FULL;\n\n-- 应用范围: GLOBAL, CATEGORY, TAG, PRODUCT\nDEFINE FIELD OVERWRITE product_scope ON price_rule TYPE string\n    PERMISSIONS FULL;\n\n-- 目标 (根据 scope): record<category> | record<tag> | record<product> | null\nDEFINE FIELD OVERWRITE target ON price_rule TYPE option<record>\n    PERMISSIONS FULL;\n\n-- 区域范围: \"zone:all\"=全部, \"zone:retail\"=零售, \"zone:xxx\"=指定区域\nDEFINE FIELD OVERWRITE zone_scope ON price_rule TYPE string\n    DEFAULT \"zone:all\"\n    PERMISSIONS FULL;\n\n-- 调整类型: PERCENTAGE, FIXED_AMOUNT\nDEFINE FIELD OVERWRITE adjustment_type ON price_rule TYPE string\n    PERMISSIONS FULL;\n\n-- 调整值 (百分比如30=30%, 固定金额如0.5)\nDEFINE FIELD OVERWRITE adjustment_value ON price_rule TYPE decimal\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_stackable ON price_rule TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- 独占规则 (不能与其他规则叠加)\nDEFINE FIELD OVERWRITE is_exclusive ON price_rule TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- 有效期开始时间\nDEFINE FIELD OVERWRITE valid_from ON price_rule TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 有效期结束时间\nDEFINE FIELD OVERWRITE valid_until ON price_rule TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 活动日 (0=周日, 1=周一, ..., 6=周六)\nDEFINE FIELD OVERWRITE active_days ON price_rule TYPE option<array<int>>\n    PERMISSIONS FULL;\n\n-- 每日开始时间 (HH:MM 格式)\nDEFINE FIELD OVERWRITE active_start_time ON price_rule TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 每日结束时间 (HH:MM 格式)\nDEFINE FIELD OVERWRITE active_end_time ON price_rule TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON price_rule TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_by ON price_rule TYPE option<record<employee>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON price_rule TYPE int\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE rule_active ON price_rule FIELDS is_active, product_scope;\n\n-- Print Destination Schema\n-- 打印目的地（抽象层）\n\nDEFINE TABLE OVERWRITE print_destination TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON print_destination TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON print_destination TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 嵌入式打印机配置\nDEFINE FIELD OVERWRITE printers ON print_destination TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- 打印机字段定义\nDEFINE FIELD OVERWRITE printers.*.printer_type ON print_destination TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.ip ON print_destination TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.port ON print_destination TYPE option<int> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.driver_name ON print_destination TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.priority ON print_destination TYPE int DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.is_active ON print_destination TYPE bool DEFAULT true PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON print_destination TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE print_dest_name ON print_destination FIELDS name UNIQUE;\n\n-- Product Table Schema\n-- 产品表\n\nDEFINE TABLE OVERWRITE product TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON product TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE image ON product TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\n-- 分类关联 (SurrealDB Record Link)\nDEFINE FIELD OVERWRITE category ON product TYPE record<category>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE sort_order ON product TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 税率 (百分比，如 10 表示 10%)\nDEFINE FIELD OVERWRITE tax_rate ON product TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 小票名称 (可选，默认使用 name)\nDEFINE FIELD OVERWRITE receipt_name ON product TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 厨房打印名称\nDEFINE FIELD OVERWRITE kitchen_print_name ON product TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 厨房打印启用状态 (-1=继承, 0=禁用, 1=启用)\nDEFINE FIELD OVERWRITE is_kitchen_print_enabled ON product TYPE int\n    DEFAULT -1\n    PERMISSIONS FULL;\n\n-- 标签打印启用状态 (-1=继承, 0=禁用, 1=启用)\nDEFINE FIELD OVERWRITE is_label_print_enabled ON product TYPE int\n    DEFAULT -1\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON product TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- 菜品编号 (POS 集成，全局唯一)\nDEFINE FIELD OVERWRITE external_id ON product TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 标签关联\nDEFINE FIELD OVERWRITE tags ON product TYPE array<record<tag>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- 嵌入式规格数组 (文档数据库风格)\nDEFINE FIELD OVERWRITE specs ON product TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- 规格对象字段定义\nDEFINE FIELD OVERWRITE specs.*.name ON product TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.price ON product TYPE decimal DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.display_order ON product TYPE int DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.is_default ON product TYPE bool DEFAULT false PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.is_active ON product TYPE bool DEFAULT true PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.receipt_name ON product TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.is_root ON product TYPE bool DEFAULT false PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE product_category ON product FIELDS category;\nDEFINE INDEX OVERWRITE product_sort_order ON product FIELDS sort_order;\nDEFINE INDEX OVERWRITE product_external_id ON product FIELDS external_id UNIQUE;\n\n-- Product Spec Index Table\n-- 不再需要：external_id 已移至 product 表级别，通过 UNIQUE INDEX 直接约束\n-- 保留此文件以确保 REMOVE TABLE 清理\nREMOVE TABLE IF EXISTS product_spec;\n\n-- Role Table Schema\n-- 角色表，存储权限角色信息\n\nDEFINE TABLE OVERWRITE role TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON role TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_name ON role TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON role TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE permissions ON role TYPE array<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_system ON role TYPE bool DEFAULT false\n    PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE is_active ON role TYPE bool DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE role_name_unique ON role FIELDS name UNIQUE;\n\n-- Script Migration Table Schema\n-- 迁移记录表，跟踪已执行的数据库迁移\n\nDEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\n\nDEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\n\nDEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n\n-- Shift Schema\n-- 班次管理表\n\nDEFINE TABLE OVERWRITE shift TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- 操作员 ID（关联 employee 表）\nDEFINE FIELD OVERWRITE operator_id ON shift TYPE record<employee>\n    PERMISSIONS FULL;\n\n-- 操作员姓名快照\nDEFINE FIELD OVERWRITE operator_name ON shift TYPE string\n    PERMISSIONS FULL;\n\n-- 班次状态\nDEFINE FIELD OVERWRITE status ON shift TYPE string\n    DEFAULT \"OPEN\"\n    PERMISSIONS FULL;\n\n-- 开班时间 (Unix timestamp millis)\nDEFINE FIELD OVERWRITE start_time ON shift TYPE int\n    PERMISSIONS FULL;\n\n-- 收班时间 (Unix timestamp millis)\nDEFINE FIELD OVERWRITE end_time ON shift TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 备用金 (开班时的现金准备金)\nDEFINE FIELD OVERWRITE starting_cash ON shift TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 预期现金 (starting_cash + 班次内现金收款)\nDEFINE FIELD OVERWRITE expected_cash ON shift TYPE decimal\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 实际现金 (收班时盘点)\nDEFINE FIELD OVERWRITE actual_cash ON shift TYPE option<decimal>\n    PERMISSIONS FULL;\n\n-- 现金差异 (actual_cash - expected_cash)\nDEFINE FIELD OVERWRITE cash_variance ON shift TYPE option<decimal>\n    PERMISSIONS FULL;\n\n-- 是否异常关闭 (断电/崩溃后自动恢复)\nDEFINE FIELD OVERWRITE abnormal_close ON shift TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- 最后活动时间 (心跳, Unix timestamp millis)\nDEFINE FIELD OVERWRITE last_active_at ON shift TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 备注\nDEFINE FIELD OVERWRITE note ON shift TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 时间戳\nDEFINE FIELD OVERWRITE created_at ON shift TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE updated_at ON shift TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 索引\nDEFINE INDEX OVERWRITE shift_status_idx ON shift FIELDS status;\nDEFINE INDEX OVERWRITE shift_operator_idx ON shift FIELDS operator_id;\nDEFINE INDEX OVERWRITE shift_start_time_idx ON shift FIELDS start_time;\n\n-- Store Info Schema\n-- 店铺信息表（单例，每个租户只有一条记录 store_info:main）\n\nDEFINE TABLE OVERWRITE store_info TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- 店铺名称\nDEFINE FIELD OVERWRITE name ON store_info TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\n-- 店铺地址\nDEFINE FIELD OVERWRITE address ON store_info TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\n-- 税号 / 营业执照 (NIF)\nDEFINE FIELD OVERWRITE nif ON store_info TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\n-- Logo URL\nDEFINE FIELD OVERWRITE logo_url ON store_info TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 联系电话\nDEFINE FIELD OVERWRITE phone ON store_info TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 电子邮箱\nDEFINE FIELD OVERWRITE email ON store_info TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 官方网站\nDEFINE FIELD OVERWRITE website ON store_info TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 营业日分界时间 (HH:MM 格式，如 \"06:00\")\n-- 用于跨天班次判断和日结报告计算\n-- 默认 \"00:00\" (午夜)，酒吧/夜店可设置为 \"06:00\"\nDEFINE FIELD OVERWRITE business_day_cutoff ON store_info TYPE string\n    DEFAULT \"00:00\"\n    PERMISSIONS FULL;\n\n-- 时间戳\nDEFINE FIELD OVERWRITE created_at ON store_info TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE updated_at ON store_info TYPE option<int>\n    PERMISSIONS FULL;\n\n-- System Issue Schema\n-- 系统问题表：本地异常检测和远程服务器推送的问题\n-- 前端按协议渲染对话框（阻塞式/通知式）\n\nDEFINE TABLE OVERWRITE system_issue TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update WHERE true\n        FOR delete NONE;\n\n-- 来源: \"local\" (本地检测) | \"remote\" (远程推送)\nDEFINE FIELD OVERWRITE source ON system_issue TYPE string\n    PERMISSIONS FULL;\n\n-- 问题类型标识，同时作为前端 i18n key\n-- 例: \"abnormal_shutdown\", \"long_downtime\", \"subscription_expiring\", \"custom_notice\"\nDEFINE FIELD OVERWRITE kind ON system_issue TYPE string\n    PERMISSIONS FULL;\n\n-- 是否阻塞 POS 操作 (true=全屏遮罩不可关闭, false=可关闭通知)\nDEFINE FIELD OVERWRITE blocking ON system_issue TYPE bool\n    PERMISSIONS FULL;\n\n-- 关联实体 (可选, \"table:id\" 格式, 如 \"order:abc123\")\nDEFINE FIELD OVERWRITE target ON system_issue TYPE option<string>\n    PERMISSIONS FULL;\n\n-- i18n 动态插值参数 (如 {\"days\": \"7\", \"hours\": \"48\"})\nDEFINE FIELD OVERWRITE params ON system_issue FLEXIBLE TYPE object DEFAULT {}\n    PERMISSIONS FULL;\n\n-- 远程广播用: 标题文本 (本地问题留空, 前端用 kind 查 i18n)\nDEFINE FIELD OVERWRITE title ON system_issue TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 远程广播用: 描述文本\nDEFINE FIELD OVERWRITE description ON system_issue TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 预定义选项 (远程广播直接填文本, 本地问题填 i18n key)\nDEFINE FIELD OVERWRITE options ON system_issue TYPE array<string> DEFAULT []\n    PERMISSIONS FULL;\n\n-- 状态: \"pending\" | \"resolved\"\nDEFINE FIELD OVERWRITE status ON system_issue TYPE string\n    DEFAULT \"pending\"\n    PERMISSIONS FULL;\n\n-- 用户选择的选项或输入的文本\nDEFINE FIELD OVERWRITE response ON system_issue TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 操作员 ID\nDEFINE FIELD OVERWRITE resolved_by ON system_issue TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 回应时间戳 (Unix 毫秒)\nDEFINE FIELD OVERWRITE resolved_at ON system_issue TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 创建时间戳 (Unix 毫秒)\nDEFINE FIELD OVERWRITE created_at ON system_issue TYPE int\n    PERMISSIONS FULL;\n\n-- 索引\nDEFINE INDEX OVERWRITE idx_system_issue_status ON system_issue FIELDS status;\nDEFINE INDEX OVERWRITE idx_system_issue_kind ON system_issue FIELDS kind;\nDEFINE INDEX OVERWRITE idx_system_issue_source ON system_issue FIELDS source;\n\n-- System State Schema\n-- 系统状态表（哈希链状态缓存，单例）\n\nDEFINE TABLE OVERWRITE system_state TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- 创世哈希\nDEFINE FIELD OVERWRITE genesis_hash ON system_state TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 最后订单\nDEFINE FIELD OVERWRITE last_order ON system_state TYPE option<record<order>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE last_order_hash ON system_state TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 同步状态\nDEFINE FIELD OVERWRITE synced_up_to ON system_state TYPE option<record<order>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE synced_up_to_hash ON system_state TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE last_sync_time ON system_state TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 统计\nDEFINE FIELD OVERWRITE order_count ON system_state TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON system_state TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE updated_at ON system_state TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- Tag Table Schema\n-- 标签表，用于给菜品/规格打标签\n\nDEFINE TABLE OVERWRITE tag TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON tag TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE color ON tag TYPE string\n    DEFAULT \"#3B82F6\"\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_order ON tag TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON tag TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- 系统标签 (热卖、新品等)，不可删除\nDEFINE FIELD OVERWRITE is_system ON tag TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE tag_name_unique ON tag FIELDS name UNIQUE;\nDEFINE INDEX OVERWRITE tag_display_order ON tag FIELDS display_order;\n\n-- Zone Schema\n-- 区域表（如：大厅、露台、包厢）\n\nDEFINE TABLE OVERWRITE zone TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON zone TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON zone TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON zone TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE zone_name ON zone FIELDS name;\n","events":""}