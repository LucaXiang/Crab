{"schemas":"--- original\n+++ modified\n@@ -1,43 +1,591 @@\n+-- Attribute Schema (Graph-oriented)\n+-- 属性表，选项直接嵌入，使用 RELATE 建立与产品/分类的关系\n+\n+DEFINE TABLE OVERWRITE attribute TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE name ON attribute TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+-- 作用域: \"global\" | \"inherited\"\n+DEFINE FIELD OVERWRITE scope ON attribute TYPE string\n+    DEFAULT \"inherited\"\n+    PERMISSIONS FULL;\n+\n+-- 排除的分类 (仅 global 生效)\n+DEFINE FIELD OVERWRITE excluded_categories ON attribute TYPE array<record<category>>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+-- 选择模式\n+DEFINE FIELD OVERWRITE is_multi_select ON attribute TYPE bool\n+    DEFAULT false\n+    PERMISSIONS FULL;\n+\n+-- 多选上限 (null = 无限)\n+DEFINE FIELD OVERWRITE max_selections ON attribute TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+-- 默认选项索引\n+DEFINE FIELD OVERWRITE default_option_idx ON attribute TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE display_order ON attribute TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_active ON attribute TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE show_on_receipt ON attribute TYPE bool\n+    DEFAULT false\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE receipt_name ON attribute TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 厨打设置\n+DEFINE FIELD OVERWRITE show_on_kitchen_print ON attribute TYPE bool\n+    DEFAULT false\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE kitchen_print_name ON attribute TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 选项直接嵌入 (Graph DB 风格: 减少 JOIN)\n+-- options: [{ name: \"微辣\", price_modifier: 0, kitchen_print_name: null }, ...]\n+DEFINE FIELD OVERWRITE options ON attribute TYPE array<object>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+DEFINE INDEX OVERWRITE attr_order ON attribute FIELDS display_order;\n+\n+-- =============================================================================\n+-- 边关系: has_attribute (产品/分类 -> 属性)\n+-- =============================================================================\n+-- 使用: RELATE product:1->has_attribute->attribute:spicy SET is_required = true\n+-- 查询: SELECT ->has_attribute->attribute FROM product:1\n+\n+DEFINE TABLE OVERWRITE has_attribute TYPE RELATION\n+    FROM product | category\n+    TO attribute\n+    SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE is_required ON has_attribute TYPE bool\n+    DEFAULT false\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE display_order ON has_attribute TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE INDEX OVERWRITE has_attr_unique ON has_attribute FIELDS in, out UNIQUE;\n+\n+-- Audit Log Table Schema\n+-- 审计日志表，记录系统操作历史\n+\n+DEFINE TABLE OVERWRITE audit_log TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select WHERE $auth.role = role:admin OR $auth.id = employee:admin\n+        FOR create FULL\n+        FOR update, delete NONE;\n+\n+-- 操作类型\n+DEFINE FIELD OVERWRITE action ON audit_log TYPE string\n+    ASSERT $value IN [\n+        'login', 'logout', 'login_failed', 'token_refresh',\n+        'read', 'create', 'update', 'delete',\n+        'config_change', 'user_create', 'user_update', 'user_delete',\n+        'role_change', 'permission_change',\n+        'server_start', 'server_stop', 'backup_create', 'backup_restore',\n+        'unauthorized_access', 'invalid_token'\n+    ]\n+    PERMISSIONS FULL;\n+\n+-- 操作资源\n+DEFINE FIELD OVERWRITE resource ON audit_log TYPE string\n+    PERMISSIONS FULL;\n+\n+-- 是否成功\n+DEFINE FIELD OVERWRITE success ON audit_log TYPE bool DEFAULT true\n+    PERMISSIONS FULL;\n+\n+-- 用户信息（可选）\n+DEFINE FIELD OVERWRITE user_id ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE username ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 请求上下文\n+DEFINE FIELD OVERWRITE ip_address ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE user_agent ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 详情\n+DEFINE FIELD OVERWRITE details ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE error ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 时间戳（自动生成，只读）\n+DEFINE FIELD OVERWRITE created_at ON audit_log TYPE datetime VALUE time::now() READONLY\n+    PERMISSIONS FULL;\n+\n+-- 索引\n+DEFINE INDEX OVERWRITE audit_action_idx ON audit_log FIELDS action;\n+DEFINE INDEX OVERWRITE audit_user_idx ON audit_log FIELDS user_id;\n+DEFINE INDEX OVERWRITE audit_resource_idx ON audit_log FIELDS resource;\n+DEFINE INDEX OVERWRITE audit_created_idx ON audit_log FIELDS created_at;\n+DEFINE INDEX OVERWRITE audit_success_idx ON audit_log FIELDS success;\n+\n+-- Category Table Schema\n+-- 产品分类表\n+\n+DEFINE TABLE OVERWRITE category TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE name ON category TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE sort_order ON category TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- 打印目的地\n+DEFINE FIELD OVERWRITE print_destinations ON category TYPE array<record<print_destination>>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_label_print_enabled ON category TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_active ON category TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+-- 虚拟分类支持\n+DEFINE FIELD OVERWRITE is_virtual ON category TYPE bool\n+    DEFAULT false\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE tag_ids ON category TYPE array<record<tag>>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE match_mode ON category TYPE string\n+    DEFAULT 'any'\n+    PERMISSIONS FULL;\n+\n+DEFINE INDEX OVERWRITE category_name_unique ON category FIELDS name UNIQUE;\n+DEFINE INDEX OVERWRITE category_sort_order ON category FIELDS sort_order;\n+\n+-- Dining Table Schema\n+-- 桌台表\n+\n+DEFINE TABLE OVERWRITE dining_table TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE name ON dining_table TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+-- 区域关联\n+DEFINE FIELD OVERWRITE zone ON dining_table TYPE record<zone>\n+    PERMISSIONS FULL;\n+\n+-- 座位数\n+DEFINE FIELD OVERWRITE capacity ON dining_table TYPE int\n+    DEFAULT 4\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_active ON dining_table TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+DEFINE INDEX OVERWRITE table_zone ON dining_table FIELDS zone;\n+DEFINE INDEX OVERWRITE table_name_zone ON dining_table FIELDS zone, name UNIQUE;\n+\n+-- Employee Table Schema\n+-- 员工表，存储系统用户信息\n+\n DEFINE TABLE OVERWRITE employee TYPE NORMAL SCHEMAFULL\n-\tPERMISSIONS\n-    // 只有 管理员才能访问\n-\t\tFOR select, create, update, delete\n-\t\t\tWHERE $auth.role = role:admin OR $auth.id = employee:admin\n-;\n-DEFINE FIELD OVERWRITE username ON employee TYPE string ASSERT string::len($value) > 0\n-\tPERMISSIONS FULL\n-;\n-DEFINE FIELD OVERWRITE hash_pass ON employee TYPE string ASSERT string::len($value) > 0\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE username ON employee TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE hash_pass ON employee TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE employee_name ON employee TYPE option<string>\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE role ON employee TYPE record<role>\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE is_system ON employee TYPE bool DEFAULT false\n-\tPERMISSIONS NONE\n-;\n+    PERMISSIONS NONE;\n+\n DEFINE FIELD OVERWRITE is_active ON employee TYPE bool DEFAULT true\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS FULL;\n+\n DEFINE INDEX OVERWRITE username_unique ON employee FIELDS username UNIQUE;\n+\n+-- Order Schema (Graph/Document hybrid)\n+-- 订单表，订单项嵌入，事件用图关系\n+\n+DEFINE TABLE OVERWRITE order TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+-- 订单号 (唯一)\n+DEFINE FIELD OVERWRITE receipt_number ON order TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+-- 区域/桌台 (快照，不使用 record link 因为需要历史记录)\n+DEFINE FIELD OVERWRITE zone_name ON order TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE table_name ON order TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 状态: OPEN, PAID, VOID\n+DEFINE FIELD OVERWRITE status ON order TYPE string\n+    DEFAULT \"OPEN\"\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE start_time ON order TYPE datetime\n+    DEFAULT time::now()\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE end_time ON order TYPE option<datetime>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE guest_count ON order TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+-- 金额 (单位: 分)\n+DEFINE FIELD OVERWRITE total_amount ON order TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE paid_amount ON order TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE discount_amount ON order TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE surcharge_amount ON order TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- 订单项 (嵌入式文档，Graph DB 风格)\n+-- items: [{ spec: product_specification:1, name: \"...\", price: 1200, qty: 2, ... }]\n+DEFINE FIELD OVERWRITE items ON order TYPE array<object>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+-- 支付记录 (嵌入式)\n+-- payments: [{ method: \"cash\", amount: 1500, time: datetime }]\n+DEFINE FIELD OVERWRITE payments ON order TYPE array<object>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+-- 哈希链 (防篡改)\n+DEFINE FIELD OVERWRITE prev_hash ON order TYPE string\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE curr_hash ON order TYPE string\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE created_at ON order TYPE datetime\n+    DEFAULT time::now()\n+    PERMISSIONS FULL;\n+\n+-- 索引\n+DEFINE INDEX OVERWRITE order_receipt ON order FIELDS receipt_number UNIQUE;\n+DEFINE INDEX OVERWRITE order_status ON order FIELDS status;\n+DEFINE INDEX OVERWRITE order_end_time ON order FIELDS end_time;\n+DEFINE INDEX OVERWRITE order_hash ON order FIELDS curr_hash;\n+\n+-- =============================================================================\n+-- 订单事件 (Graph Edge)\n+-- =============================================================================\n+-- 使用: RELATE order:1->has_event->order_event:xxx\n+-- 查询: SELECT ->has_event->order_event FROM order:1 ORDER BY timestamp\n+\n+DEFINE TABLE OVERWRITE order_event TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+-- 事件类型: CREATED, ITEM_ADDED, ITEM_REMOVED, PAID, VOID, etc.\n+DEFINE FIELD OVERWRITE event_type ON order_event TYPE string\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE timestamp ON order_event TYPE datetime\n+    DEFAULT time::now()\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE data ON order_event TYPE option<object>\n+    PERMISSIONS FULL;\n+\n+-- 哈希链\n+DEFINE FIELD OVERWRITE prev_hash ON order_event TYPE string\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE curr_hash ON order_event TYPE string\n+    PERMISSIONS FULL;\n+\n+-- 订单事件边关系\n+DEFINE TABLE OVERWRITE has_event TYPE RELATION\n+    FROM order\n+    TO order_event\n+    SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE INDEX OVERWRITE event_time ON order_event FIELDS timestamp;\n+\n+-- Price Rule Schema\n+-- 价格调整规则（折扣/附加费）\n+\n+DEFINE TABLE OVERWRITE price_rule TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE name ON price_rule TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE display_name ON price_rule TYPE string\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE receipt_name ON price_rule TYPE string\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE description ON price_rule TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 规则类型: DISCOUNT, SURCHARGE\n+DEFINE FIELD OVERWRITE rule_type ON price_rule TYPE string\n+    ASSERT $value IN [\"DISCOUNT\", \"SURCHARGE\"]\n+    PERMISSIONS FULL;\n+\n+-- 应用范围: GLOBAL, CATEGORY, TAG, PRODUCT\n+DEFINE FIELD OVERWRITE product_scope ON price_rule TYPE string\n+    ASSERT $value IN [\"GLOBAL\", \"CATEGORY\", \"TAG\", \"PRODUCT\"]\n+    PERMISSIONS FULL;\n+\n+-- 目标 (根据 scope): record<category> | record<tag> | record<product> | null\n+DEFINE FIELD OVERWRITE target ON price_rule TYPE option<record>\n+    PERMISSIONS FULL;\n+\n+-- 区域范围: -1=全部, 0=零售, >0=指定区域\n+DEFINE FIELD OVERWRITE zone_scope ON price_rule TYPE int\n+    DEFAULT -1\n+    PERMISSIONS FULL;\n+\n+-- 调整类型: PERCENTAGE, FIXED_AMOUNT\n+DEFINE FIELD OVERWRITE adjustment_type ON price_rule TYPE string\n+    ASSERT $value IN [\"PERCENTAGE\", \"FIXED_AMOUNT\"]\n+    PERMISSIONS FULL;\n+\n+-- 调整值 (百分比如30=30%, 固定金额单位:分)\n+DEFINE FIELD OVERWRITE adjustment_value ON price_rule TYPE int\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE priority ON price_rule TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_stackable ON price_rule TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+-- 时间模式: ALWAYS, SCHEDULE, ONETIME\n+DEFINE FIELD OVERWRITE time_mode ON price_rule TYPE string\n+    DEFAULT \"ALWAYS\"\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE start_time ON price_rule TYPE option<datetime>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE end_time ON price_rule TYPE option<datetime>\n+    PERMISSIONS FULL;\n+\n+-- 周期配置 (JSON)\n+DEFINE FIELD OVERWRITE schedule_config ON price_rule TYPE option<object>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_active ON price_rule TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE created_by ON price_rule TYPE option<record<employee>>\n+    PERMISSIONS FULL;\n+\n+DEFINE INDEX OVERWRITE rule_active ON price_rule FIELDS is_active, product_scope, time_mode;\n+\n+-- Print Destination Schema\n+-- 打印目的地（抽象层）\n+\n+DEFINE TABLE OVERWRITE print_destination TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE name ON print_destination TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE description ON print_destination TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 嵌入式打印机配置\n+DEFINE FIELD OVERWRITE printers ON print_destination TYPE array<object>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+-- 打印机字段定义\n+DEFINE FIELD OVERWRITE printers.*.printer_type ON print_destination TYPE string PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE printers.*.ip ON print_destination TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE printers.*.port ON print_destination TYPE option<int> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE printers.*.driver_name ON print_destination TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE printers.*.priority ON print_destination TYPE int DEFAULT 0 PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE printers.*.is_active ON print_destination TYPE bool DEFAULT true PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_active ON print_destination TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+DEFINE INDEX OVERWRITE print_dest_name ON print_destination FIELDS name UNIQUE;\n+\n+-- Product Table Schema\n+-- 产品表\n+\n+DEFINE TABLE OVERWRITE product TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE name ON product TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE image ON product TYPE string\n+    DEFAULT \"\"\n+    PERMISSIONS FULL;\n+\n+-- 分类关联 (SurrealDB Record Link)\n+DEFINE FIELD OVERWRITE category ON product TYPE record<category>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE sort_order ON product TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- 税率 (百分比，如 10 表示 10%)\n+DEFINE FIELD OVERWRITE tax_rate ON product TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- 小票名称 (可选，默认使用 name)\n+DEFINE FIELD OVERWRITE receipt_name ON product TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 厨房打印名称\n+DEFINE FIELD OVERWRITE kitchen_print_name ON product TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 打印目的地\n+DEFINE FIELD OVERWRITE print_destinations ON product TYPE array<record<print_destination>>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_label_print_enabled ON product TYPE int\n+    DEFAULT -1\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_active ON product TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+-- 标签关联\n+DEFINE FIELD OVERWRITE tags ON product TYPE array<record<tag>>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+-- 嵌入式规格数组 (文档数据库风格)\n+DEFINE FIELD OVERWRITE specs ON product TYPE array<object>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+-- 规格对象字段定义\n+DEFINE FIELD OVERWRITE specs.*.name ON product TYPE string PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE specs.*.price ON product TYPE int DEFAULT 0 PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE specs.*.display_order ON product TYPE int DEFAULT 0 PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE specs.*.is_default ON product TYPE bool DEFAULT false PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE specs.*.is_active ON product TYPE bool DEFAULT true PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE specs.*.external_id ON product TYPE option<int> PERMISSIONS FULL;\n+\n+DEFINE INDEX OVERWRITE product_category ON product FIELDS category;\n+DEFINE INDEX OVERWRITE product_sort_order ON product FIELDS sort_order;\n+DEFINE INDEX OVERWRITE product_external_id ON product FIELDS specs[*].external_id;\n+\n+-- Role Table Schema\n+-- 角色表，存储权限角色信息\n+\n DEFINE TABLE OVERWRITE role TYPE NORMAL SCHEMAFULL\n-\tPERMISSIONS\n-\t\tFOR select,create, update, delete\n-\t\t\tWHERE $auth.role = role:admin OR $auth.id = employee:admin\n-;\n-DEFINE FIELD OVERWRITE role_name ON role TYPE string ASSERT string::len($value) > 0\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE role_name ON role TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE permissions ON role TYPE array<string>\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE is_system ON role TYPE bool DEFAULT false\n-\tPERMISSIONS NONE\n-;\n+    PERMISSIONS NONE;\n+\n DEFINE FIELD OVERWRITE is_active ON role TYPE bool DEFAULT true\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS FULL;\n+\n DEFINE INDEX OVERWRITE role_name_unique ON role FIELDS role_name UNIQUE;\n+\n+-- Script Migration Table Schema\n+-- 迁移记录表，跟踪已执行的数据库迁移\n+\n DEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n     PERMISSIONS\n         FOR select FULL\n@@ -44,5 +592,97 @@\n         FOR create, update, delete NONE;\n\n DEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\n+\n DEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\n+\n DEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n+\n+-- System State Schema\n+-- 系统状态表（哈希链状态缓存，单例）\n+\n+DEFINE TABLE OVERWRITE system_state TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+-- 创世哈希\n+DEFINE FIELD OVERWRITE genesis_hash ON system_state TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 最后订单\n+DEFINE FIELD OVERWRITE last_order ON system_state TYPE option<record<order>>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE last_order_hash ON system_state TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 同步状态\n+DEFINE FIELD OVERWRITE synced_up_to ON system_state TYPE option<record<order>>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE synced_up_to_hash ON system_state TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE last_sync_time ON system_state TYPE option<datetime>\n+    PERMISSIONS FULL;\n+\n+-- 统计\n+DEFINE FIELD OVERWRITE order_count ON system_state TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE created_at ON system_state TYPE datetime\n+    DEFAULT time::now()\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE updated_at ON system_state TYPE datetime\n+    DEFAULT time::now()\n+    PERMISSIONS FULL;\n+\n+-- Tag Table Schema\n+-- 标签表，用于给菜品/规格打标签\n+\n+DEFINE TABLE OVERWRITE tag TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE name ON tag TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE color ON tag TYPE string\n+    DEFAULT \"#3B82F6\"\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE display_order ON tag TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_active ON tag TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+DEFINE INDEX OVERWRITE tag_name_unique ON tag FIELDS name UNIQUE;\n+DEFINE INDEX OVERWRITE tag_display_order ON tag FIELDS display_order;\n+\n+-- Zone Schema\n+-- 区域表（如：大厅、露台、包厢）\n+\n+DEFINE TABLE OVERWRITE zone TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE name ON zone TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE description ON zone TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE is_active ON zone TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+DEFINE INDEX OVERWRITE zone_name ON zone FIELDS name;\n","events":null}