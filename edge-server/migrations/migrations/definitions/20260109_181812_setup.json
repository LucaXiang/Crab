{"schemas":"--- original\n+++ modified\n@@ -1,43 +1,120 @@\n+-- Audit Log Table Schema\n+-- 审计日志表，记录系统操作历史\n+\n+DEFINE TABLE OVERWRITE audit_log TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select WHERE $auth.role = role:admin OR $auth.id = employee:admin\n+        FOR create FULL\n+        FOR update, delete NONE;\n+\n+-- 操作类型\n+DEFINE FIELD OVERWRITE action ON audit_log TYPE string\n+    ASSERT $value IN [\n+        'login', 'logout', 'login_failed', 'token_refresh',\n+        'read', 'create', 'update', 'delete',\n+        'config_change', 'user_create', 'user_update', 'user_delete',\n+        'role_change', 'permission_change',\n+        'server_start', 'server_stop', 'backup_create', 'backup_restore',\n+        'unauthorized_access', 'invalid_token'\n+    ]\n+    PERMISSIONS FULL;\n+\n+-- 操作资源\n+DEFINE FIELD OVERWRITE resource ON audit_log TYPE string\n+    PERMISSIONS FULL;\n+\n+-- 是否成功\n+DEFINE FIELD OVERWRITE success ON audit_log TYPE bool DEFAULT true\n+    PERMISSIONS FULL;\n+\n+-- 用户信息（可选）\n+DEFINE FIELD OVERWRITE user_id ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE username ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 请求上下文\n+DEFINE FIELD OVERWRITE ip_address ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE user_agent ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 详情\n+DEFINE FIELD OVERWRITE details ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE error ON audit_log TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- 时间戳（自动生成，只读）\n+DEFINE FIELD OVERWRITE created_at ON audit_log TYPE datetime VALUE time::now() READONLY\n+    PERMISSIONS FULL;\n+\n+-- 索引\n+DEFINE INDEX OVERWRITE audit_action_idx ON audit_log FIELDS action;\n+DEFINE INDEX OVERWRITE audit_user_idx ON audit_log FIELDS user_id;\n+DEFINE INDEX OVERWRITE audit_resource_idx ON audit_log FIELDS resource;\n+DEFINE INDEX OVERWRITE audit_created_idx ON audit_log FIELDS created_at;\n+DEFINE INDEX OVERWRITE audit_success_idx ON audit_log FIELDS success;\n+\n+-- Employee Table Schema\n+-- 员工表，存储系统用户信息\n+\n DEFINE TABLE OVERWRITE employee TYPE NORMAL SCHEMAFULL\n-\tPERMISSIONS\n-    // 只有 管理员才能访问\n-\t\tFOR select, create, update, delete\n-\t\t\tWHERE $auth.role = role:admin OR $auth.id = employee:admin\n-;\n-DEFINE FIELD OVERWRITE username ON employee TYPE string ASSERT string::len($value) > 0\n-\tPERMISSIONS FULL\n-;\n-DEFINE FIELD OVERWRITE hash_pass ON employee TYPE string ASSERT string::len($value) > 0\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE username ON employee TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE hash_pass ON employee TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE employee_name ON employee TYPE option<string>\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE role ON employee TYPE record<role>\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE is_system ON employee TYPE bool DEFAULT false\n-\tPERMISSIONS NONE\n-;\n+    PERMISSIONS NONE;\n+\n DEFINE FIELD OVERWRITE is_active ON employee TYPE bool DEFAULT true\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS FULL;\n+\n DEFINE INDEX OVERWRITE username_unique ON employee FIELDS username UNIQUE;\n+\n+-- Role Table Schema\n+-- 角色表，存储权限角色信息\n+\n DEFINE TABLE OVERWRITE role TYPE NORMAL SCHEMAFULL\n-\tPERMISSIONS\n-\t\tFOR select,create, update, delete\n-\t\t\tWHERE $auth.role = role:admin OR $auth.id = employee:admin\n-;\n-DEFINE FIELD OVERWRITE role_name ON role TYPE string ASSERT string::len($value) > 0\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+DEFINE FIELD OVERWRITE role_name ON role TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE permissions ON role TYPE array<string>\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE is_system ON role TYPE bool DEFAULT false\n-\tPERMISSIONS NONE\n-;\n+    PERMISSIONS NONE;\n+\n DEFINE FIELD OVERWRITE is_active ON role TYPE bool DEFAULT true\n-\tPERMISSIONS FULL\n-;\n+    PERMISSIONS FULL;\n+\n DEFINE INDEX OVERWRITE role_name_unique ON role FIELDS role_name UNIQUE;\n+\n+-- Script Migration Table Schema\n+-- 迁移记录表，跟踪已执行的数据库迁移\n+\n DEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n     PERMISSIONS\n         FOR select FULL\n@@ -44,5 +121,7 @@\n         FOR create, update, delete NONE;\n\n DEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\n+\n DEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\n+\n DEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n","events":null}