{"schemas":"--- original\n+++ modified\n@@ -1,3 +1,65 @@\n+-- Archive Verification Schema\n+-- \u5f52\u6863\u54c8\u5e0c\u94fe\u9a8c\u8bc1\u8bb0\u5f55\u8868\uff08\u7531 VerifyScheduler \u81ea\u52a8\u5199\u5165\uff09\n+\n+DEFINE TABLE OVERWRITE archive_verification TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select WHERE $auth.role = role:admin OR $auth.id = employee:admin\n+        FOR create FULL\n+        FOR update, delete NONE;\n+\n+-- \u9a8c\u8bc1\u7c7b\u578b\n+DEFINE FIELD OVERWRITE verification_type ON archive_verification TYPE string\n+    ASSERT $value IN [\"daily\", \"full\"]\n+    PERMISSIONS FULL;\n+\n+-- \u8425\u4e1a\u65e5\u6807\u7b7e (daily: \"2026-01-29\", full: None)\n+DEFINE FIELD OVERWRITE date ON archive_verification TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u8ba2\u5355\u7edf\u8ba1\n+DEFINE FIELD OVERWRITE total_orders ON archive_verification TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE verified_orders ON archive_verification TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u94fe\u8def\u5b8c\u6574\u6027\n+DEFINE FIELD OVERWRITE chain_intact ON archive_verification TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+-- \u5f02\u5e38\u8ba1\u6570\n+DEFINE FIELD OVERWRITE chain_resets_count ON archive_verification TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE chain_breaks_count ON archive_verification TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE invalid_orders_count ON archive_verification TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u6709\u5f02\u5e38\u65f6\u5b58\u50a8\u5b8c\u6574\u9a8c\u8bc1\u7ed3\u679c JSON\n+DEFINE FIELD OVERWRITE details ON archive_verification TYPE option<object>\n+    PERMISSIONS FULL;\n+\n+-- \u65f6\u95f4\u6233\uff08\u81ea\u52a8\u751f\u6210\uff0c\u53ea\u8bfb\uff09\n+DEFINE FIELD OVERWRITE created_at ON archive_verification TYPE int READONLY\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u7d22\u5f15\n+DEFINE INDEX OVERWRITE av_type_idx ON archive_verification FIELDS verification_type;\n+DEFINE INDEX OVERWRITE av_date_idx ON archive_verification FIELDS date;\n+DEFINE INDEX OVERWRITE av_created_idx ON archive_verification FIELDS created_at;\n+DEFINE INDEX OVERWRITE av_intact_idx ON archive_verification FIELDS chain_intact;\n+-- Fix #3: \u53bb\u91cd\u7ea6\u675f\uff08\u540c\u7c7b\u578b+\u540c\u65e5\u671f\u53ea\u4fdd\u7559\u4e00\u6761\uff09\n+DEFINE INDEX OVERWRITE av_type_date_unique ON archive_verification FIELDS verification_type, date UNIQUE;\n+\n -- Attribute Schema (Graph-oriented)\n -- \u5c5e\u6027\u8868\uff0c\u9009\u9879\u76f4\u63a5\u5d4c\u5165\uff0c\u4f7f\u7528 RELATE \u5efa\u7acb\u4e0e\u4ea7\u54c1/\u5206\u7c7b\u7684\u5173\u7cfb\n\n@@ -19,8 +81,8 @@\n DEFINE FIELD OVERWRITE max_selections ON attribute TYPE option<int>\n     PERMISSIONS FULL;\n\n--- \u9ed8\u8ba4\u9009\u9879\u7d22\u5f15\n-DEFINE FIELD OVERWRITE default_option_idx ON attribute TYPE option<int>\n+-- \u9ed8\u8ba4\u9009\u9879\u7d22\u5f15 (\u652f\u6301\u591a\u9009)\n+DEFINE FIELD OVERWRITE default_option_indices ON attribute TYPE option<array<int>>\n     PERMISSIONS FULL;\n\n DEFINE FIELD OVERWRITE display_order ON attribute TYPE int\n@@ -52,6 +114,27 @@\n     DEFAULT []\n     PERMISSIONS FULL;\n\n+DEFINE FIELD OVERWRITE options.*.name ON attribute TYPE string\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE options.*.price_modifier ON attribute TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE options.*.display_order ON attribute TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE options.*.is_active ON attribute TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE options.*.receipt_name ON attribute TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE options.*.kitchen_print_name ON attribute TYPE option<string>\n+    PERMISSIONS FULL;\n+\n DEFINE INDEX OVERWRITE attr_order ON attribute FIELDS display_order;\n\n -- =============================================================================\n@@ -76,14 +159,15 @@\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n--- \u8986\u76d6\u5c5e\u6027\u7684\u9ed8\u8ba4\u9009\u9879\u7d22\u5f15\n-DEFINE FIELD OVERWRITE default_option_idx ON has_attribute TYPE option<int>\n+-- \u8986\u76d6\u5c5e\u6027\u7684\u9ed8\u8ba4\u9009\u9879\u7d22\u5f15 (\u652f\u6301\u591a\u9009)\n+DEFINE FIELD OVERWRITE default_option_indices ON has_attribute TYPE option<array<int>>\n     PERMISSIONS FULL;\n\n DEFINE INDEX OVERWRITE has_attr_unique ON has_attribute FIELDS in, out UNIQUE;\n\n -- Audit Log Table Schema\n--- \u5ba1\u8ba1\u65e5\u5fd7\u8868\uff0c\u8bb0\u5f55\u7cfb\u7edf\u64cd\u4f5c\u5386\u53f2\n+-- \u7a0e\u52a1\u7ea7\u5ba1\u8ba1\u65e5\u5fd7\u8868\uff0cSHA256 \u54c8\u5e0c\u94fe\u9632\u7be1\u6539\n+-- Append-only: \u4e0d\u5141\u8bb8 update/delete\n\n DEFINE TABLE OVERWRITE audit_log TYPE NORMAL SCHEMAFULL\n     PERMISSIONS\n@@ -91,57 +175,56 @@\n         FOR create FULL\n         FOR update, delete NONE;\n\n--- \u64cd\u4f5c\u7c7b\u578b\n-DEFINE FIELD OVERWRITE action ON audit_log TYPE string\n-    ASSERT $value IN [\n-        'login', 'logout', 'login_failed', 'token_refresh',\n-        'read', 'create', 'update', 'delete',\n-        'config_change', 'user_create', 'user_update', 'user_delete',\n-        'role_change', 'permission_change',\n-        'server_start', 'server_stop', 'backup_create', 'backup_restore',\n-        'unauthorized_access', 'invalid_token'\n-    ]\n+-- \u5e8f\u5217\u53f7\uff08\u5168\u5c40\u9012\u589e\uff0c\u54c8\u5e0c\u94fe\u6807\u8bc6\uff09\n+DEFINE FIELD OVERWRITE sequence ON audit_log TYPE int\n+    PERMISSIONS FULL;\n+\n+-- \u65f6\u95f4\u6233\uff08Unix \u6beb\u79d2\uff09\n+DEFINE FIELD OVERWRITE timestamp ON audit_log TYPE int\n     PERMISSIONS FULL;\n\n--- \u64cd\u4f5c\u8d44\u6e90\n-DEFINE FIELD OVERWRITE resource ON audit_log TYPE string\n+-- \u64cd\u4f5c\u7c7b\u578b\uff08snake_case \u5b57\u7b26\u4e32\uff0c\u4e0e Rust AuditAction \u679a\u4e3e\u5bf9\u5e94\uff09\n+DEFINE FIELD OVERWRITE action ON audit_log TYPE string\n     PERMISSIONS FULL;\n\n--- \u662f\u5426\u6210\u529f\n-DEFINE FIELD OVERWRITE success ON audit_log TYPE bool DEFAULT true\n+-- \u8d44\u6e90\u7c7b\u578b\uff08\u5982 \"system\", \"auth\", \"order\", \"employee\"\uff09\n+DEFINE FIELD OVERWRITE resource_type ON audit_log TYPE string\n     PERMISSIONS FULL;\n\n--- \u7528\u6237\u4fe1\u606f\uff08\u53ef\u9009\uff09\n-DEFINE FIELD OVERWRITE user_id ON audit_log TYPE option<string>\n+-- \u8d44\u6e90 ID\uff08\u5982 \"server:main\", \"employee:emp1\"\uff09\n+DEFINE FIELD OVERWRITE resource_id ON audit_log TYPE string\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE username ON audit_log TYPE option<string>\n+-- \u64cd\u4f5c\u4eba ID\uff08\u7cfb\u7edf\u4e8b\u4ef6\u4e3a null\uff09\n+DEFINE FIELD OVERWRITE operator_id ON audit_log TYPE option<string>\n     PERMISSIONS FULL;\n\n--- \u8bf7\u6c42\u4e0a\u4e0b\u6587\n-DEFINE FIELD OVERWRITE ip_address ON audit_log TYPE option<string>\n+-- \u64cd\u4f5c\u4eba\u540d\u79f0\n+DEFINE FIELD OVERWRITE operator_name ON audit_log TYPE option<string>\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE user_agent ON audit_log TYPE option<string>\n+-- \u7ed3\u6784\u5316\u8be6\u60c5\uff08\u4efb\u610f JSON \u5bf9\u8c61\uff09\n+DEFINE FIELD OVERWRITE details ON audit_log FLEXIBLE TYPE object DEFAULT {}\n     PERMISSIONS FULL;\n\n--- \u8be6\u60c5\n-DEFINE FIELD OVERWRITE details ON audit_log TYPE option<string>\n+-- \u5173\u8054\u76ee\u6807\uff08\u53ef\u9009\uff0c\u6307\u5411\u76f8\u5173\u5ba1\u8ba1\u6761\u76ee\u6216\u8d44\u6e90\uff0c\u5982 \"system_issue:xxx\"\uff09\n+DEFINE FIELD OVERWRITE target ON audit_log TYPE option<string>\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE error ON audit_log TYPE option<string>\n+-- SHA256 \u54c8\u5e0c\u94fe \u2014 \u524d\u4e00\u6761\u5ba1\u8ba1\u65e5\u5fd7\u54c8\u5e0c\n+DEFINE FIELD OVERWRITE prev_hash ON audit_log TYPE string\n     PERMISSIONS FULL;\n\n--- \u65f6\u95f4\u6233\uff08\u81ea\u52a8\u751f\u6210\uff0c\u53ea\u8bfb\uff09\n-DEFINE FIELD OVERWRITE created_at ON audit_log TYPE datetime VALUE time::now() READONLY\n+-- SHA256 \u54c8\u5e0c\u94fe \u2014 \u5f53\u524d\u8bb0\u5f55\u54c8\u5e0c\n+DEFINE FIELD OVERWRITE curr_hash ON audit_log TYPE string\n     PERMISSIONS FULL;\n\n -- \u7d22\u5f15\n+DEFINE INDEX OVERWRITE audit_sequence_idx ON audit_log FIELDS sequence UNIQUE;\n+DEFINE INDEX OVERWRITE audit_timestamp_idx ON audit_log FIELDS timestamp;\n DEFINE INDEX OVERWRITE audit_action_idx ON audit_log FIELDS action;\n-DEFINE INDEX OVERWRITE audit_user_idx ON audit_log FIELDS user_id;\n-DEFINE INDEX OVERWRITE audit_resource_idx ON audit_log FIELDS resource;\n-DEFINE INDEX OVERWRITE audit_created_idx ON audit_log FIELDS created_at;\n-DEFINE INDEX OVERWRITE audit_success_idx ON audit_log FIELDS success;\n+DEFINE INDEX OVERWRITE audit_operator_idx ON audit_log FIELDS operator_id;\n+DEFINE INDEX OVERWRITE audit_resource_type_idx ON audit_log FIELDS resource_type;\n\n -- Category Table Schema\n -- \u4ea7\u54c1\u5206\u7c7b\u8868\n@@ -199,6 +282,114 @@\n DEFINE INDEX OVERWRITE category_name_unique ON category FIELDS name UNIQUE;\n DEFINE INDEX OVERWRITE category_sort_order ON category FIELDS sort_order;\n\n+-- Daily Report Schema\n+-- \u65e5\u7ed3\u62a5\u544a\u8868\n+\n+DEFINE TABLE OVERWRITE daily_report TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+-- \u8425\u4e1a\u65e5\u671f (YYYY-MM-DD)\n+DEFINE FIELD OVERWRITE business_date ON daily_report TYPE string\n+    ASSERT string::len($value) = 10\n+    PERMISSIONS FULL;\n+\n+-- === \u8ba2\u5355\u7edf\u8ba1 ===\n+\n+-- \u603b\u8ba2\u5355\u6570\n+DEFINE FIELD OVERWRITE total_orders ON daily_report TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u5b8c\u6210\u8ba2\u5355\u6570\n+DEFINE FIELD OVERWRITE completed_orders ON daily_report TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u4f5c\u5e9f\u8ba2\u5355\u6570\n+DEFINE FIELD OVERWRITE void_orders ON daily_report TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- === \u91d1\u989d\u7edf\u8ba1 ===\n+\n+-- \u603b\u8425\u4e1a\u989d (completed orders)\n+DEFINE FIELD OVERWRITE total_sales ON daily_report TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u5df2\u652f\u4ed8\u91d1\u989d\n+DEFINE FIELD OVERWRITE total_paid ON daily_report TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u672a\u652f\u4ed8\u91d1\u989d\n+DEFINE FIELD OVERWRITE total_unpaid ON daily_report TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u4f5c\u5e9f\u8ba2\u5355\u91d1\u989d\n+DEFINE FIELD OVERWRITE void_amount ON daily_report TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u7a0e\u989d\u603b\u8ba1\n+DEFINE FIELD OVERWRITE total_tax ON daily_report TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u6298\u6263\u603b\u8ba1\n+DEFINE FIELD OVERWRITE total_discount ON daily_report TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u9644\u52a0\u8d39\u603b\u8ba1\n+DEFINE FIELD OVERWRITE total_surcharge ON daily_report TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- === \u7a0e\u7387\u5206\u7c7b (\u897f\u73ed\u7259 IVA) ===\n+DEFINE FIELD OVERWRITE tax_breakdowns ON daily_report TYPE array<object>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE tax_breakdowns.*.tax_rate ON daily_report TYPE int PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE tax_breakdowns.*.net_amount ON daily_report TYPE decimal DEFAULT 0 PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE tax_breakdowns.*.tax_amount ON daily_report TYPE decimal DEFAULT 0 PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE tax_breakdowns.*.gross_amount ON daily_report TYPE decimal DEFAULT 0 PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE tax_breakdowns.*.order_count ON daily_report TYPE int DEFAULT 0 PERMISSIONS FULL;\n+\n+-- === \u652f\u4ed8\u65b9\u5f0f\u5206\u7c7b ===\n+DEFINE FIELD OVERWRITE payment_breakdowns ON daily_report TYPE array<object>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE payment_breakdowns.*.method ON daily_report TYPE string PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE payment_breakdowns.*.amount ON daily_report TYPE decimal DEFAULT 0 PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE payment_breakdowns.*.count ON daily_report TYPE int DEFAULT 0 PERMISSIONS FULL;\n+\n+-- === \u751f\u6210\u4fe1\u606f ===\n+\n+-- \u751f\u6210\u65f6\u95f4 (Unix timestamp millis)\n+DEFINE FIELD OVERWRITE generated_at ON daily_report TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+-- \u751f\u6210\u4eba ID\n+DEFINE FIELD OVERWRITE generated_by_id ON daily_report TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u751f\u6210\u4eba\u59d3\u540d\n+DEFINE FIELD OVERWRITE generated_by_name ON daily_report TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u5907\u6ce8\n+DEFINE FIELD OVERWRITE note ON daily_report TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u7d22\u5f15\n+DEFINE INDEX OVERWRITE daily_report_date_unique ON daily_report FIELDS business_date UNIQUE;\n+\n -- Dining Table Schema\n -- \u684c\u53f0\u8868\n\n@@ -282,8 +473,7 @@\n     PERMISSIONS FULL;\n\n -- \u521b\u5efa\u65f6\u95f4\n-DEFINE FIELD OVERWRITE created_at ON image_ref TYPE datetime\n-    DEFAULT time::now()\n+DEFINE FIELD OVERWRITE created_at ON image_ref TYPE int\n     PERMISSIONS FULL;\n\n -- \u552f\u4e00\u7d22\u5f15\uff1a\u540c\u4e00\u5b9e\u4f53\u5bf9\u540c\u4e00\u56fe\u7247\u53ea\u8bb0\u5f55\u4e00\u6b21\n@@ -295,6 +485,98 @@\n -- \u5b9e\u4f53\u7d22\u5f15\uff1a\u5feb\u901f\u67e5\u627e\u5b9e\u4f53\u7684\u6240\u6709\u56fe\u7247\u5f15\u7528\n DEFINE INDEX OVERWRITE idx_image_ref_entity ON image_ref FIELDS entity_type, entity_id;\n\n+-- Label Template Schema\n+-- \u6807\u7b7e\u6253\u5370\u6a21\u677f\u8868\n+\n+DEFINE TABLE OVERWRITE label_template TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+-- \u6a21\u677f\u540d\u79f0\n+DEFINE FIELD OVERWRITE name ON label_template TYPE string\n+    ASSERT string::len($value) > 0\n+    PERMISSIONS FULL;\n+\n+-- \u6a21\u677f\u63cf\u8ff0\n+DEFINE FIELD OVERWRITE description ON label_template TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u6807\u7b7e\u5bbd\u5ea6 (mm)\n+DEFINE FIELD OVERWRITE width ON label_template TYPE float\n+    PERMISSIONS FULL;\n+\n+-- \u6807\u7b7e\u9ad8\u5ea6 (mm)\n+DEFINE FIELD OVERWRITE height ON label_template TYPE float\n+    PERMISSIONS FULL;\n+\n+-- \u5185\u8fb9\u8ddd (mm)\n+DEFINE FIELD OVERWRITE padding ON label_template TYPE float\n+    DEFAULT 2.0\n+    PERMISSIONS FULL;\n+\n+-- \u6a21\u677f\u5b57\u6bb5\u5217\u8868 (\u5d4c\u5165\u5f0f\u6570\u7ec4)\n+DEFINE FIELD OVERWRITE fields ON label_template TYPE array<object>\n+    DEFAULT []\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE fields.*.id ON label_template TYPE string PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.name ON label_template TYPE string PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.type ON label_template TYPE string\n+    ASSERT $value IN [\"text\", \"barcode\", \"qrcode\", \"image\", \"separator\", \"datetime\", \"price\", \"counter\"]\n+    PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.x ON label_template TYPE float PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.y ON label_template TYPE float PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.width ON label_template TYPE float PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.height ON label_template TYPE float PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.font_size ON label_template TYPE int DEFAULT 10 PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.font_weight ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.font_family ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.color ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.rotate ON label_template TYPE option<int> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.alignment ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.data_source ON label_template TYPE string PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.format ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.visible ON label_template TYPE bool DEFAULT true PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.label ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.template ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.data_key ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.source_type ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.maintain_aspect_ratio ON label_template TYPE option<bool> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.style ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.align ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.vertical_align ON label_template TYPE option<string> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE fields.*.line_style ON label_template TYPE option<string> PERMISSIONS FULL;\n+\n+-- \u662f\u5426\u9ed8\u8ba4\u6a21\u677f\n+DEFINE FIELD OVERWRITE is_default ON label_template TYPE bool\n+    DEFAULT false\n+    PERMISSIONS FULL;\n+\n+-- \u662f\u5426\u542f\u7528\n+DEFINE FIELD OVERWRITE is_active ON label_template TYPE bool\n+    DEFAULT true\n+    PERMISSIONS FULL;\n+\n+-- UI \u517c\u5bb9\u5b57\u6bb5\n+DEFINE FIELD OVERWRITE width_mm ON label_template TYPE option<float> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE height_mm ON label_template TYPE option<float> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE padding_mm_x ON label_template TYPE option<float> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE padding_mm_y ON label_template TYPE option<float> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE render_dpi ON label_template TYPE option<int> PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE test_data ON label_template TYPE option<string> PERMISSIONS FULL;\n+\n+-- \u65f6\u95f4\u6233\n+DEFINE FIELD OVERWRITE created_at ON label_template TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE updated_at ON label_template TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+-- \u7d22\u5f15\n+DEFINE INDEX OVERWRITE label_template_name_idx ON label_template FIELDS name;\n+DEFINE INDEX OVERWRITE label_template_active_idx ON label_template FIELDS is_active;\n+\n -- Order Schema (Graph Model)\n -- \u5f52\u6863\u8ba2\u5355\u4f7f\u7528\u56fe\u8fb9\u5173\u7cfb\uff0c\u53ea\u5b58\u50a8\u6838\u5fc3\u6570\u636e\n\n@@ -328,39 +610,38 @@\n DEFINE FIELD OVERWRITE guest_count ON order TYPE option<int>\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE original_total ON order TYPE float\n+DEFINE FIELD OVERWRITE original_total ON order TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE subtotal ON order TYPE float\n+DEFINE FIELD OVERWRITE subtotal ON order TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE total_amount ON order TYPE float\n+DEFINE FIELD OVERWRITE total_amount ON order TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE paid_amount ON order TYPE float\n+DEFINE FIELD OVERWRITE paid_amount ON order TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE discount_amount ON order TYPE float\n+DEFINE FIELD OVERWRITE discount_amount ON order TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE surcharge_amount ON order TYPE float\n+DEFINE FIELD OVERWRITE surcharge_amount ON order TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE tax ON order TYPE float\n+DEFINE FIELD OVERWRITE tax ON order TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE start_time ON order TYPE datetime\n-    DEFAULT time::now()\n+DEFINE FIELD OVERWRITE start_time ON order TYPE int\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE end_time ON order TYPE option<datetime>\n+DEFINE FIELD OVERWRITE end_time ON order TYPE option<int>\n     PERMISSIONS FULL;\n\n DEFINE FIELD OVERWRITE operator_id ON order TYPE option<string>\n@@ -369,6 +650,18 @@\n DEFINE FIELD OVERWRITE operator_name ON order TYPE option<string>\n     PERMISSIONS FULL;\n\n+DEFINE FIELD OVERWRITE void_type ON order TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE loss_reason ON order TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE loss_amount ON order TYPE option<decimal>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE void_note ON order TYPE option<string>\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE related_order_id ON order TYPE option<record<order>>\n     PERMISSIONS FULL;\n\n@@ -378,8 +671,7 @@\n DEFINE FIELD OVERWRITE curr_hash ON order TYPE string\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE created_at ON order TYPE datetime\n-    DEFAULT time::now()\n+DEFINE FIELD OVERWRITE created_at ON order TYPE int\n     PERMISSIONS FULL;\n\n DEFINE INDEX OVERWRITE order_receipt ON order FIELDS receipt_number UNIQUE;\n@@ -386,6 +678,8 @@\n DEFINE INDEX OVERWRITE order_status ON order FIELDS status;\n DEFINE INDEX OVERWRITE order_end_time ON order FIELDS end_time;\n DEFINE INDEX OVERWRITE order_hash ON order FIELDS curr_hash;\n+DEFINE INDEX OVERWRITE order_status_end_time ON order FIELDS status, end_time;\n+DEFINE INDEX OVERWRITE order_created_at ON order FIELDS created_at;\n\n -- =============================================================================\n -- order_item \u8868\n@@ -408,7 +702,7 @@\n DEFINE FIELD OVERWRITE spec_name ON order_item TYPE option<string>\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE price ON order_item TYPE float\n+DEFINE FIELD OVERWRITE price ON order_item TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n@@ -420,23 +714,23 @@\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE unit_price ON order_item TYPE float\n+DEFINE FIELD OVERWRITE unit_price ON order_item TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE line_total ON order_item TYPE float\n+DEFINE FIELD OVERWRITE line_total ON order_item TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE discount_amount ON order_item TYPE float\n+DEFINE FIELD OVERWRITE discount_amount ON order_item TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE surcharge_amount ON order_item TYPE float\n+DEFINE FIELD OVERWRITE surcharge_amount ON order_item TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE tax ON order_item TYPE float\n+DEFINE FIELD OVERWRITE tax ON order_item TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n@@ -444,6 +738,9 @@\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n+DEFINE FIELD OVERWRITE category_name ON order_item TYPE option<string>\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE note ON order_item TYPE option<string>\n     PERMISSIONS FULL;\n\n@@ -465,7 +762,7 @@\n DEFINE FIELD OVERWRITE option_name ON order_item_option TYPE string\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE price ON order_item_option TYPE float\n+DEFINE FIELD OVERWRITE price ON order_item_option TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n@@ -478,18 +775,21 @@\n         FOR select, create\n             WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n+DEFINE FIELD OVERWRITE seq ON order_payment TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE payment_id ON order_payment TYPE string\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE method ON order_payment TYPE string\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE amount ON order_payment TYPE float\n+DEFINE FIELD OVERWRITE amount ON order_payment TYPE decimal\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE time ON order_payment TYPE datetime\n-    DEFAULT time::now()\n-    PERMISSIONS FULL;\n-\n-DEFINE FIELD OVERWRITE reference ON order_payment TYPE option<string>\n+DEFINE FIELD OVERWRITE time ON order_payment TYPE int\n     PERMISSIONS FULL;\n\n DEFINE FIELD OVERWRITE cancelled ON order_payment TYPE bool\n@@ -499,9 +799,18 @@\n DEFINE FIELD OVERWRITE cancel_reason ON order_payment TYPE option<string>\n     PERMISSIONS FULL;\n\n+DEFINE FIELD OVERWRITE split_type ON order_payment TYPE option<string>\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE split_items ON order_payment TYPE option<string>\n     PERMISSIONS FULL;\n\n+DEFINE FIELD OVERWRITE aa_shares ON order_payment TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE aa_total_shares ON order_payment TYPE option<int>\n+    PERMISSIONS FULL;\n+\n DEFINE INDEX OVERWRITE payment_method ON order_payment FIELDS method;\n DEFINE INDEX OVERWRITE payment_time ON order_payment FIELDS time;\n\n@@ -514,11 +823,14 @@\n         FOR select, create\n             WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n+DEFINE FIELD OVERWRITE seq ON order_event TYPE int\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n DEFINE FIELD OVERWRITE event_type ON order_event TYPE string\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE timestamp ON order_event TYPE datetime\n-    DEFAULT time::now()\n+DEFINE FIELD OVERWRITE timestamp ON order_event TYPE int\n     PERMISSIONS FULL;\n\n DEFINE FIELD OVERWRITE data ON order_event TYPE option<string>\n@@ -541,21 +853,69 @@\n     PERMISSIONS FOR select, create\n         WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n+DEFINE INDEX OVERWRITE has_item_in ON has_item FIELDS in;\n+\n DEFINE TABLE OVERWRITE has_option TYPE RELATION\n     FROM order_item TO order_item_option SCHEMAFULL\n     PERMISSIONS FOR select, create\n         WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n+DEFINE INDEX OVERWRITE has_option_in ON has_option FIELDS in;\n+\n DEFINE TABLE OVERWRITE has_payment TYPE RELATION\n     FROM order TO order_payment SCHEMAFULL\n     PERMISSIONS FOR select, create\n         WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n+DEFINE INDEX OVERWRITE has_payment_in ON has_payment FIELDS in;\n+\n DEFINE TABLE OVERWRITE has_event TYPE RELATION\n     FROM order TO order_event SCHEMAFULL\n     PERMISSIONS FOR select, create\n         WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n+DEFINE INDEX OVERWRITE has_event_in ON has_event FIELDS in;\n+\n+-- Payment \u72ec\u7acb\u8868\uff1a\u652f\u4ed8\u8bb0\u5f55\uff08\u4ece\u8ba2\u5355\u4e8b\u4ef6\u6eaf\u6e90\u6295\u5f71\uff09\n+-- \u5f52\u6863\u65f6\u5199\u5165\uff0c\u65b9\u4fbf\u7edf\u8ba1\u548c\u5bf9\u8d26\n+\n+DEFINE TABLE OVERWRITE payment TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update WHERE true\n+        FOR delete NONE;\n+\n+-- \u6838\u5fc3\u5b57\u6bb5\n+DEFINE FIELD OVERWRITE payment_id    ON payment TYPE string;\n+DEFINE FIELD OVERWRITE order_id      ON payment TYPE string;\n+DEFINE FIELD OVERWRITE method        ON payment TYPE string;        -- CASH / CARD\n+DEFINE FIELD OVERWRITE amount        ON payment TYPE decimal;\n+DEFINE FIELD OVERWRITE tendered      ON payment TYPE option<decimal>; -- \u73b0\u91d1\u5b9e\u6536\n+DEFINE FIELD OVERWRITE change_amount ON payment TYPE option<decimal>; -- \u627e\u96f6\n+DEFINE FIELD OVERWRITE note          ON payment TYPE option<string>;\n+\n+-- \u5206\u5355\u4e0a\u4e0b\u6587\n+DEFINE FIELD OVERWRITE split_type    ON payment TYPE option<string>; -- ItemSplit / AmountSplit / AaSplit / null\n+DEFINE FIELD OVERWRITE aa_shares     ON payment TYPE option<int>;\n+DEFINE FIELD OVERWRITE split_items   ON payment TYPE option<string>; -- JSON string [{name, quantity, unit_price}]\n+\n+-- \u64cd\u4f5c\u4eba\n+DEFINE FIELD OVERWRITE operator_id   ON payment TYPE option<string>;\n+DEFINE FIELD OVERWRITE operator_name ON payment TYPE option<string>;\n+\n+-- \u53d6\u6d88\n+DEFINE FIELD OVERWRITE cancelled     ON payment TYPE bool DEFAULT false;\n+DEFINE FIELD OVERWRITE cancel_reason ON payment TYPE option<string>;\n+\n+-- \u65f6\u95f4\n+DEFINE FIELD OVERWRITE timestamp     ON payment TYPE int;   -- \u652f\u4ed8\u65f6\u95f4 (unix ms)\n+DEFINE FIELD OVERWRITE created_at    ON payment TYPE int;    -- \u8bb0\u5f55\u521b\u5efa\u65f6\u95f4\n+\n+-- \u7d22\u5f15\n+DEFINE INDEX OVERWRITE idx_payment_id  ON payment FIELDS payment_id UNIQUE;\n+DEFINE INDEX OVERWRITE idx_order_id    ON payment FIELDS order_id;\n+DEFINE INDEX OVERWRITE idx_timestamp   ON payment FIELDS timestamp;\n+DEFINE INDEX OVERWRITE idx_operator    ON payment FIELDS operator_id;\n+\n -- Price Rule Schema\n -- \u4ef7\u683c\u8c03\u6574\u89c4\u5219\uff08\u6298\u6263/\u9644\u52a0\u8d39\uff09\n\n@@ -602,7 +962,7 @@\n     PERMISSIONS FULL;\n\n -- \u8c03\u6574\u503c (\u767e\u5206\u6bd4\u598230=30%, \u56fa\u5b9a\u91d1\u989d\u59820.5)\n-DEFINE FIELD OVERWRITE adjustment_value ON price_rule TYPE float\n+DEFINE FIELD OVERWRITE adjustment_value ON price_rule TYPE decimal\n     PERMISSIONS FULL;\n\n\n -- \u6709\u6548\u671f\u5f00\u59cb\u65f6\u95f4\n-DEFINE FIELD OVERWRITE valid_from ON price_rule TYPE option<datetime>\n+DEFINE FIELD OVERWRITE valid_from ON price_rule TYPE option<int>\n     PERMISSIONS FULL;\n\n -- \u6709\u6548\u671f\u7ed3\u675f\u65f6\u95f4\n-DEFINE FIELD OVERWRITE valid_until ON price_rule TYPE option<datetime>\n+DEFINE FIELD OVERWRITE valid_until ON price_rule TYPE option<int>\n     PERMISSIONS FULL;\n\n -- \u6d3b\u52a8\u65e5 (0=\u5468\u65e5, 1=\u5468\u4e00, ..., 6=\u5468\u516d)\n@@ -645,8 +1005,7 @@\n DEFINE FIELD OVERWRITE created_by ON price_rule TYPE option<record<employee>>\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE created_at ON price_rule TYPE datetime\n-    DEFAULT time::now()\n+DEFINE FIELD OVERWRITE created_at ON price_rule TYPE int\n     PERMISSIONS FULL;\n\n DEFINE INDEX OVERWRITE rule_active ON price_rule FIELDS is_active, product_scope;\n@@ -758,7 +1117,7 @@\n\n -- \u89c4\u683c\u5bf9\u8c61\u5b57\u6bb5\u5b9a\u4e49\n DEFINE FIELD OVERWRITE specs.*.name ON product TYPE string PERMISSIONS FULL;\n-DEFINE FIELD OVERWRITE specs.*.price ON product TYPE float DEFAULT 0 PERMISSIONS FULL;\n+DEFINE FIELD OVERWRITE specs.*.price ON product TYPE decimal DEFAULT 0 PERMISSIONS FULL;\n DEFINE FIELD OVERWRITE specs.*.display_order ON product TYPE int DEFAULT 0 PERMISSIONS FULL;\n DEFINE FIELD OVERWRITE specs.*.is_default ON product TYPE bool DEFAULT false PERMISSIONS FULL;\n DEFINE FIELD OVERWRITE specs.*.is_active ON product TYPE bool DEFAULT true PERMISSIONS FULL;\n@@ -842,6 +1201,200 @@\n\n DEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n\n+-- Shift Schema\n+-- \u73ed\u6b21\u7ba1\u7406\u8868\n+\n+DEFINE TABLE OVERWRITE shift TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+-- \u64cd\u4f5c\u5458 ID\uff08\u5173\u8054 employee \u8868\uff09\n+DEFINE FIELD OVERWRITE operator_id ON shift TYPE record<employee>\n+    PERMISSIONS FULL;\n+\n+-- \u64cd\u4f5c\u5458\u59d3\u540d\u5feb\u7167\n+DEFINE FIELD OVERWRITE operator_name ON shift TYPE string\n+    PERMISSIONS FULL;\n+\n+-- \u73ed\u6b21\u72b6\u6001\n+DEFINE FIELD OVERWRITE status ON shift TYPE string\n+    DEFAULT \"OPEN\"\n+    ASSERT $value IN [\"OPEN\", \"CLOSED\"]\n+    PERMISSIONS FULL;\n+\n+-- \u5f00\u73ed\u65f6\u95f4 (Unix timestamp millis)\n+DEFINE FIELD OVERWRITE start_time ON shift TYPE int\n+    PERMISSIONS FULL;\n+\n+-- \u6536\u73ed\u65f6\u95f4 (Unix timestamp millis)\n+DEFINE FIELD OVERWRITE end_time ON shift TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+-- \u5907\u7528\u91d1 (\u5f00\u73ed\u65f6\u7684\u73b0\u91d1\u51c6\u5907\u91d1)\n+DEFINE FIELD OVERWRITE starting_cash ON shift TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u9884\u671f\u73b0\u91d1 (starting_cash + \u73ed\u6b21\u5185\u73b0\u91d1\u6536\u6b3e)\n+DEFINE FIELD OVERWRITE expected_cash ON shift TYPE decimal\n+    DEFAULT 0\n+    PERMISSIONS FULL;\n+\n+-- \u5b9e\u9645\u73b0\u91d1 (\u6536\u73ed\u65f6\u76d8\u70b9)\n+DEFINE FIELD OVERWRITE actual_cash ON shift TYPE option<decimal>\n+    PERMISSIONS FULL;\n+\n+-- \u73b0\u91d1\u5dee\u5f02 (actual_cash - expected_cash)\n+DEFINE FIELD OVERWRITE cash_variance ON shift TYPE option<decimal>\n+    PERMISSIONS FULL;\n+\n+-- \u662f\u5426\u5f02\u5e38\u5173\u95ed (\u65ad\u7535/\u5d29\u6e83\u540e\u81ea\u52a8\u6062\u590d)\n+DEFINE FIELD OVERWRITE abnormal_close ON shift TYPE bool\n+    DEFAULT false\n+    PERMISSIONS FULL;\n+\n+-- \u6700\u540e\u6d3b\u52a8\u65f6\u95f4 (\u5fc3\u8df3, Unix timestamp millis)\n+DEFINE FIELD OVERWRITE last_active_at ON shift TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+-- \u5907\u6ce8\n+DEFINE FIELD OVERWRITE note ON shift TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u65f6\u95f4\u6233\n+DEFINE FIELD OVERWRITE created_at ON shift TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE updated_at ON shift TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+-- \u7d22\u5f15\n+DEFINE INDEX OVERWRITE shift_status_idx ON shift FIELDS status;\n+DEFINE INDEX OVERWRITE shift_operator_idx ON shift FIELDS operator_id;\n+DEFINE INDEX OVERWRITE shift_start_time_idx ON shift FIELDS start_time;\n+\n+-- Store Info Schema\n+-- \u5e97\u94fa\u4fe1\u606f\u8868\uff08\u5355\u4f8b\uff0c\u6bcf\u4e2a\u79df\u6237\u53ea\u6709\u4e00\u6761\u8bb0\u5f55 store_info:main\uff09\n+\n+DEFINE TABLE OVERWRITE store_info TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update, delete\n+            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n+\n+-- \u5e97\u94fa\u540d\u79f0\n+DEFINE FIELD OVERWRITE name ON store_info TYPE string\n+    DEFAULT \"\"\n+    PERMISSIONS FULL;\n+\n+-- \u5e97\u94fa\u5730\u5740\n+DEFINE FIELD OVERWRITE address ON store_info TYPE string\n+    DEFAULT \"\"\n+    PERMISSIONS FULL;\n+\n+-- \u7a0e\u53f7 / \u8425\u4e1a\u6267\u7167 (NIF)\n+DEFINE FIELD OVERWRITE nif ON store_info TYPE string\n+    DEFAULT \"\"\n+    PERMISSIONS FULL;\n+\n+-- Logo URL\n+DEFINE FIELD OVERWRITE logo_url ON store_info TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u8054\u7cfb\u7535\u8bdd\n+DEFINE FIELD OVERWRITE phone ON store_info TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u7535\u5b50\u90ae\u7bb1\n+DEFINE FIELD OVERWRITE email ON store_info TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u5b98\u65b9\u7f51\u7ad9\n+DEFINE FIELD OVERWRITE website ON store_info TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u8425\u4e1a\u65e5\u5206\u754c\u65f6\u95f4 (HH:MM \u683c\u5f0f\uff0c\u5982 \"06:00\")\n+-- \u7528\u4e8e\u8de8\u5929\u73ed\u6b21\u5224\u65ad\u548c\u65e5\u7ed3\u62a5\u544a\u8ba1\u7b97\n+-- \u9ed8\u8ba4 \"00:00\" (\u5348\u591c)\uff0c\u9152\u5427/\u591c\u5e97\u53ef\u8bbe\u7f6e\u4e3a \"06:00\"\n+DEFINE FIELD OVERWRITE business_day_cutoff ON store_info TYPE string\n+    DEFAULT \"00:00\"\n+    PERMISSIONS FULL;\n+\n+-- \u65f6\u95f4\u6233\n+DEFINE FIELD OVERWRITE created_at ON store_info TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+DEFINE FIELD OVERWRITE updated_at ON store_info TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+-- System Issue Schema\n+-- \u7cfb\u7edf\u95ee\u9898\u8868\uff1a\u672c\u5730\u5f02\u5e38\u68c0\u6d4b\u548c\u8fdc\u7a0b\u670d\u52a1\u5668\u63a8\u9001\u7684\u95ee\u9898\n+-- \u524d\u7aef\u6309\u534f\u8bae\u6e32\u67d3\u5bf9\u8bdd\u6846\uff08\u963b\u585e\u5f0f/\u901a\u77e5\u5f0f\uff09\n+\n+DEFINE TABLE OVERWRITE system_issue TYPE NORMAL SCHEMAFULL\n+    PERMISSIONS\n+        FOR select, create, update WHERE true\n+        FOR delete NONE;\n+\n+-- \u6765\u6e90: \"local\" (\u672c\u5730\u68c0\u6d4b) | \"remote\" (\u8fdc\u7a0b\u63a8\u9001)\n+DEFINE FIELD OVERWRITE source ON system_issue TYPE string\n+    PERMISSIONS FULL;\n+\n+-- \u95ee\u9898\u7c7b\u578b\u6807\u8bc6\uff0c\u540c\u65f6\u4f5c\u4e3a\u524d\u7aef i18n key\n+-- \u4f8b: \"abnormal_shutdown\", \"long_downtime\", \"subscription_expiring\", \"custom_notice\"\n+DEFINE FIELD OVERWRITE kind ON system_issue TYPE string\n+    PERMISSIONS FULL;\n+\n+-- \u662f\u5426\u963b\u585e POS \u64cd\u4f5c (true=\u5168\u5c4f\u906e\u7f69\u4e0d\u53ef\u5173\u95ed, false=\u53ef\u5173\u95ed\u901a\u77e5)\n+DEFINE FIELD OVERWRITE blocking ON system_issue TYPE bool\n+    PERMISSIONS FULL;\n+\n+-- \u5173\u8054\u5b9e\u4f53 (\u53ef\u9009, \"table:id\" \u683c\u5f0f, \u5982 \"order:abc123\")\n+DEFINE FIELD OVERWRITE target ON system_issue TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- i18n \u52a8\u6001\u63d2\u503c\u53c2\u6570 (\u5982 {\"days\": \"7\", \"hours\": \"48\"})\n+DEFINE FIELD OVERWRITE params ON system_issue FLEXIBLE TYPE object DEFAULT {}\n+    PERMISSIONS FULL;\n+\n+-- \u8fdc\u7a0b\u5e7f\u64ad\u7528: \u6807\u9898\u6587\u672c (\u672c\u5730\u95ee\u9898\u7559\u7a7a, \u524d\u7aef\u7528 kind \u67e5 i18n)\n+DEFINE FIELD OVERWRITE title ON system_issue TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u8fdc\u7a0b\u5e7f\u64ad\u7528: \u63cf\u8ff0\u6587\u672c\n+DEFINE FIELD OVERWRITE description ON system_issue TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u9884\u5b9a\u4e49\u9009\u9879 (\u8fdc\u7a0b\u5e7f\u64ad\u76f4\u63a5\u586b\u6587\u672c, \u672c\u5730\u95ee\u9898\u586b i18n key)\n+DEFINE FIELD OVERWRITE options ON system_issue TYPE array<string> DEFAULT []\n+    PERMISSIONS FULL;\n+\n+-- \u72b6\u6001: \"pending\" | \"resolved\"\n+DEFINE FIELD OVERWRITE status ON system_issue TYPE string\n+    DEFAULT \"pending\"\n+    PERMISSIONS FULL;\n+\n+-- \u7528\u6237\u9009\u62e9\u7684\u9009\u9879\u6216\u8f93\u5165\u7684\u6587\u672c\n+DEFINE FIELD OVERWRITE response ON system_issue TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u64cd\u4f5c\u5458 ID\n+DEFINE FIELD OVERWRITE resolved_by ON system_issue TYPE option<string>\n+    PERMISSIONS FULL;\n+\n+-- \u56de\u5e94\u65f6\u95f4\u6233 (Unix \u6beb\u79d2)\n+DEFINE FIELD OVERWRITE resolved_at ON system_issue TYPE option<int>\n+    PERMISSIONS FULL;\n+\n+-- \u521b\u5efa\u65f6\u95f4\u6233 (Unix \u6beb\u79d2)\n+DEFINE FIELD OVERWRITE created_at ON system_issue TYPE int\n+    PERMISSIONS FULL;\n+\n+-- \u7d22\u5f15\n+DEFINE INDEX OVERWRITE idx_system_issue_status ON system_issue FIELDS status;\n+DEFINE INDEX OVERWRITE idx_system_issue_kind ON system_issue FIELDS kind;\n+DEFINE INDEX OVERWRITE idx_system_issue_source ON system_issue FIELDS source;\n+\n -- System State Schema\n -- \u7cfb\u7edf\u72b6\u6001\u8868\uff08\u54c8\u5e0c\u94fe\u72b6\u6001\u7f13\u5b58\uff0c\u5355\u4f8b\uff09\n\n@@ -868,7 +1421,7 @@\n DEFINE FIELD OVERWRITE synced_up_to_hash ON system_state TYPE option<string>\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE last_sync_time ON system_state TYPE option<datetime>\n+DEFINE FIELD OVERWRITE last_sync_time ON system_state TYPE option<int>\n     PERMISSIONS FULL;\n\n -- \u7edf\u8ba1\n@@ -876,12 +1429,12 @@\n     DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE created_at ON system_state TYPE datetime\n-    DEFAULT time::now()\n+DEFINE FIELD OVERWRITE created_at ON system_state TYPE int\n+    DEFAULT 0\n     PERMISSIONS FULL;\n\n-DEFINE FIELD OVERWRITE updated_at ON system_state TYPE datetime\n-    DEFAULT time::now()\n+DEFINE FIELD OVERWRITE updated_at ON system_state TYPE int\n+    DEFAULT 0\n     PERMISSIONS FULL;\n\n -- Tag Table Schema\n","events":null}