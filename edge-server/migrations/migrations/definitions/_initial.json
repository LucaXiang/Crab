{"schemas": "-- Attribute Schema (Graph-oriented)\n-- 属性表，选项直接嵌入，使用 RELATE 建立与产品/分类的关系\n\nDEFINE TABLE OVERWRITE attribute TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON attribute TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\n-- 选择模式\nDEFINE FIELD OVERWRITE is_multi_select ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- 多选上限 (null = 无限)\nDEFINE FIELD OVERWRITE max_selections ON attribute TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 默认选项索引\nDEFINE FIELD OVERWRITE default_option_idx ON attribute TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_order ON attribute TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON attribute TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE show_on_receipt ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE receipt_name ON attribute TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 厨打设置\nDEFINE FIELD OVERWRITE show_on_kitchen_print ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE kitchen_print_name ON attribute TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 选项直接嵌入 (Graph DB 风格: 减少 JOIN)\n-- options: [{ name: \"微辣\", price_modifier: 0, kitchen_print_name: null }, ...]\nDEFINE FIELD OVERWRITE options ON attribute TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE attr_order ON attribute FIELDS display_order;\n\n-- =============================================================================\n-- 边关系: has_attribute (产品/分类 -> 属性)\n-- =============================================================================\n-- 使用: RELATE product:1->has_attribute->attribute:spicy SET is_required = true\n-- 查询: SELECT ->has_attribute->attribute FROM product:1\n\nDEFINE TABLE OVERWRITE has_attribute TYPE RELATION\n    FROM product | category\n    TO attribute\n    SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE is_required ON has_attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_order ON has_attribute TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 覆盖属性的默认选项索引\nDEFINE FIELD OVERWRITE default_option_idx ON has_attribute TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE has_attr_unique ON has_attribute FIELDS in, out UNIQUE;\n\n-- Audit Log Table Schema\n-- 审计日志表，记录系统操作历史\n\nDEFINE TABLE OVERWRITE audit_log TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select WHERE $auth.role = role:admin OR $auth.id = employee:admin\n        FOR create FULL\n        FOR update, delete NONE;\n\n-- 操作类型\nDEFINE FIELD OVERWRITE action ON audit_log TYPE string\n    ASSERT $value IN [\n        'login', 'logout', 'login_failed', 'token_refresh',\n        'read', 'create', 'update', 'delete',\n        'config_change', 'user_create', 'user_update', 'user_delete',\n        'role_change', 'permission_change',\n        'server_start', 'server_stop', 'backup_create', 'backup_restore',\n        'unauthorized_access', 'invalid_token'\n    ]\n    PERMISSIONS FULL;\n\n-- 操作资源\nDEFINE FIELD OVERWRITE resource ON audit_log TYPE string\n    PERMISSIONS FULL;\n\n-- 是否成功\nDEFINE FIELD OVERWRITE success ON audit_log TYPE bool DEFAULT true\n    PERMISSIONS FULL;\n\n-- 用户信息（可选）\nDEFINE FIELD OVERWRITE user_id ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE username ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 请求上下文\nDEFINE FIELD OVERWRITE ip_address ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE user_agent ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 详情\nDEFINE FIELD OVERWRITE details ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE error ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 时间戳（自动生成，只读）\nDEFINE FIELD OVERWRITE created_at ON audit_log TYPE datetime VALUE time::now() READONLY\n    PERMISSIONS FULL;\n\n-- 索引\nDEFINE INDEX OVERWRITE audit_action_idx ON audit_log FIELDS action;\nDEFINE INDEX OVERWRITE audit_user_idx ON audit_log FIELDS user_id;\nDEFINE INDEX OVERWRITE audit_resource_idx ON audit_log FIELDS resource;\nDEFINE INDEX OVERWRITE audit_created_idx ON audit_log FIELDS created_at;\nDEFINE INDEX OVERWRITE audit_success_idx ON audit_log FIELDS success;\n\n-- Category Table Schema\n-- 产品分类表\n\nDEFINE TABLE OVERWRITE category TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON category TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE sort_order ON category TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 打印目的地\nDEFINE FIELD OVERWRITE print_destinations ON category TYPE array<record<print_destination>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- 厨房打印开关\nDEFINE FIELD OVERWRITE is_kitchen_print_enabled ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- 标签打印开关\nDEFINE FIELD OVERWRITE is_label_print_enabled ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- 虚拟分类支持\nDEFINE FIELD OVERWRITE is_virtual ON category TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tag_ids ON category TYPE array<record<tag>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE match_mode ON category TYPE string\n    DEFAULT 'any'\n    PERMISSIONS FULL;\n\n-- 是否在 POS 主页显示此分类\nDEFINE FIELD OVERWRITE is_display ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE category_name_unique ON category FIELDS name UNIQUE;\nDEFINE INDEX OVERWRITE category_sort_order ON category FIELDS sort_order;\n\n-- Dining Table Schema\n-- 桌台表\n\nDEFINE TABLE OVERWRITE dining_table TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON dining_table TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\n-- 区域关联\nDEFINE FIELD OVERWRITE zone ON dining_table TYPE record<zone>\n    PERMISSIONS FULL;\n\n-- 座位数\nDEFINE FIELD OVERWRITE capacity ON dining_table TYPE int\n    DEFAULT 4\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON dining_table TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE table_zone ON dining_table FIELDS zone;\nDEFINE INDEX OVERWRITE table_name_zone ON dining_table FIELDS zone, name UNIQUE;\n\n-- Employee Table Schema\n-- 员工表，存储系统用户信息\n\nDEFINE TABLE OVERWRITE employee TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE username ON employee TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE hash_pass ON employee TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_name ON employee TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE role ON employee TYPE record<role>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_system ON employee TYPE bool DEFAULT false\n    PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE is_active ON employee TYPE bool DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE username_unique ON employee FIELDS username UNIQUE;\n\n-- Image Reference Table Schema\n-- 图片引用计数表，用于跟踪图片被哪些实体引用\n\nDEFINE TABLE OVERWRITE image_ref TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- 图片哈希 (SHA256 内容哈希)\nDEFINE FIELD OVERWRITE hash ON image_ref TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\n-- 引用实体类型: \"product\", \"label_template\"\nDEFINE FIELD OVERWRITE entity_type ON image_ref TYPE string\n    ASSERT $value IN [\"product\", \"label_template\"]\n    PERMISSIONS FULL;\n\n-- 引用实体 ID (格式: \"product:xxx\" 或 \"label_template:xxx\")\nDEFINE FIELD OVERWRITE entity_id ON image_ref TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\n-- 创建时间\nDEFINE FIELD OVERWRITE created_at ON image_ref TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\n-- 唯一索引：同一实体对同一图片只记录一次\nDEFINE INDEX OVERWRITE idx_image_ref_unique ON image_ref FIELDS hash, entity_type, entity_id UNIQUE;\n\n-- 哈希索引：快速查找图片的所有引用\nDEFINE INDEX OVERWRITE idx_image_ref_hash ON image_ref FIELDS hash;\n\n-- 实体索引：快速查找实体的所有图片引用\nDEFINE INDEX OVERWRITE idx_image_ref_entity ON image_ref FIELDS entity_type, entity_id;\n\n-- Order Schema (Graph Model)\n-- 归档订单使用图边关系，只存储核心数据\n\n-- =============================================================================\n-- order 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE receipt_number ON order TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE zone_name ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE table_name ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE status ON order TYPE string\n    ASSERT $value IN [\"COMPLETED\", \"VOID\", \"MOVED\", \"MERGED\"]\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_retail ON order TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE guest_count ON order TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE original_total ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE subtotal ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE total_amount ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE paid_amount ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE discount_amount ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE surcharge_amount ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE start_time ON order TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE end_time ON order TYPE option<datetime>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE operator_id ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE operator_name ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE related_order_id ON order TYPE option<record<order>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE prev_hash ON order TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE curr_hash ON order TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON order TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE order_receipt ON order FIELDS receipt_number UNIQUE;\nDEFINE INDEX OVERWRITE order_status ON order FIELDS status;\nDEFINE INDEX OVERWRITE order_end_time ON order FIELDS end_time;\nDEFINE INDEX OVERWRITE order_hash ON order FIELDS curr_hash;\n\n-- =============================================================================\n-- order_item 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_item TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE spec ON order_item TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE instance_id ON order_item TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE name ON order_item TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE spec_name ON order_item TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE price ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE quantity ON order_item TYPE int\n    DEFAULT 1\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE unpaid_quantity ON order_item TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE unit_price ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE line_total ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE discount_amount ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE surcharge_amount ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax_rate ON order_item TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE note ON order_item TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE order_item_spec ON order_item FIELDS spec;\nDEFINE INDEX OVERWRITE order_item_instance ON order_item FIELDS instance_id;\n\n-- =============================================================================\n-- order_item_option 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_item_option TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE attribute_name ON order_item_option TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE option_name ON order_item_option TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE price ON order_item_option TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- =============================================================================\n-- order_payment 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_payment TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE method ON order_payment TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE amount ON order_payment TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE time ON order_payment TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE reference ON order_payment TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE cancelled ON order_payment TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE cancel_reason ON order_payment TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE split_items ON order_payment TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE payment_method ON order_payment FIELDS method;\nDEFINE INDEX OVERWRITE payment_time ON order_payment FIELDS time;\n\n-- =============================================================================\n-- order_event 表\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_event TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE event_type ON order_event TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE timestamp ON order_event TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE data ON order_event TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE prev_hash ON order_event TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE curr_hash ON order_event TYPE string\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE event_time ON order_event FIELDS timestamp;\n\n-- =============================================================================\n-- 图边关系\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE has_item TYPE RELATION\n    FROM order TO order_item SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE TABLE OVERWRITE has_option TYPE RELATION\n    FROM order_item TO order_item_option SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE TABLE OVERWRITE has_payment TYPE RELATION\n    FROM order TO order_payment SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE TABLE OVERWRITE has_event TYPE RELATION\n    FROM order TO order_event SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- Price Rule Schema\n-- 价格调整规则（折扣/附加费）\n\nDEFINE TABLE OVERWRITE price_rule TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON price_rule TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_name ON price_rule TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE receipt_name ON price_rule TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON price_rule TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 规则类型: DISCOUNT, SURCHARGE\nDEFINE FIELD OVERWRITE rule_type ON price_rule TYPE string\n    ASSERT $value IN [\"DISCOUNT\", \"SURCHARGE\"]\n    PERMISSIONS FULL;\n\n-- 应用范围: GLOBAL, CATEGORY, TAG, PRODUCT\nDEFINE FIELD OVERWRITE product_scope ON price_rule TYPE string\n    ASSERT $value IN [\"GLOBAL\", \"CATEGORY\", \"TAG\", \"PRODUCT\"]\n    PERMISSIONS FULL;\n\n-- 目标 (根据 scope): record<category> | record<tag> | record<product> | null\nDEFINE FIELD OVERWRITE target ON price_rule TYPE option<record>\n    PERMISSIONS FULL;\n\n-- 区域范围: \"zone:all\"=全部, \"zone:retail\"=零售, \"zone:xxx\"=指定区域\nDEFINE FIELD OVERWRITE zone_scope ON price_rule TYPE string\n    DEFAULT \"zone:all\"\n    PERMISSIONS FULL;\n\n-- 调整类型: PERCENTAGE, FIXED_AMOUNT\nDEFINE FIELD OVERWRITE adjustment_type ON price_rule TYPE string\n    ASSERT $value IN [\"PERCENTAGE\", \"FIXED_AMOUNT\"]\n    PERMISSIONS FULL;\n\n-- 调整值 (百分比如30=30%, 固定金额如0.5)\nDEFINE FIELD OVERWRITE adjustment_value ON price_rule TYPE float\n    PERMISSIONS FULL;\n\n\nDEFINE FIELD OVERWRITE is_stackable ON price_rule TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- 独占规则 (不能与其他规则叠加)\nDEFINE FIELD OVERWRITE is_exclusive ON price_rule TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- 有效期开始时间\nDEFINE FIELD OVERWRITE valid_from ON price_rule TYPE option<datetime>\n    PERMISSIONS FULL;\n\n-- 有效期结束时间\nDEFINE FIELD OVERWRITE valid_until ON price_rule TYPE option<datetime>\n    PERMISSIONS FULL;\n\n-- 活动日 (0=周日, 1=周一, ..., 6=周六)\nDEFINE FIELD OVERWRITE active_days ON price_rule TYPE option<array<int>>\n    PERMISSIONS FULL;\n\n-- 每日开始时间 (HH:MM 格式)\nDEFINE FIELD OVERWRITE active_start_time ON price_rule TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 每日结束时间 (HH:MM 格式)\nDEFINE FIELD OVERWRITE active_end_time ON price_rule TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON price_rule TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_by ON price_rule TYPE option<record<employee>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON price_rule TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE rule_active ON price_rule FIELDS is_active, product_scope;\n\n-- Print Destination Schema\n-- 打印目的地（抽象层）\n\nDEFINE TABLE OVERWRITE print_destination TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON print_destination TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON print_destination TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 嵌入式打印机配置\nDEFINE FIELD OVERWRITE printers ON print_destination TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- 打印机字段定义\nDEFINE FIELD OVERWRITE printers.*.printer_type ON print_destination TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.ip ON print_destination TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.port ON print_destination TYPE option<int> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.driver_name ON print_destination TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.priority ON print_destination TYPE int DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.is_active ON print_destination TYPE bool DEFAULT true PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON print_destination TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE print_dest_name ON print_destination FIELDS name UNIQUE;\n\n-- Product Table Schema\n-- 产品表\n\nDEFINE TABLE OVERWRITE product TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON product TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE image ON product TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\n-- 分类关联 (SurrealDB Record Link)\nDEFINE FIELD OVERWRITE category ON product TYPE record<category>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE sort_order ON product TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 税率 (百分比，如 10 表示 10%)\nDEFINE FIELD OVERWRITE tax_rate ON product TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- 小票名称 (可选，默认使用 name)\nDEFINE FIELD OVERWRITE receipt_name ON product TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 厨房打印名称\nDEFINE FIELD OVERWRITE kitchen_print_name ON product TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 厨房打印目的地\nDEFINE FIELD OVERWRITE kitchen_print_destinations ON product TYPE array<record<print_destination>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- 标签打印目的地\nDEFINE FIELD OVERWRITE label_print_destinations ON product TYPE array<record<print_destination>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- 厨房打印启用状态 (-1=继承, 0=禁用, 1=启用)\nDEFINE FIELD OVERWRITE is_kitchen_print_enabled ON product TYPE int\n    DEFAULT -1\n    PERMISSIONS FULL;\n\n-- 标签打印启用状态 (-1=继承, 0=禁用, 1=启用)\nDEFINE FIELD OVERWRITE is_label_print_enabled ON product TYPE int\n    DEFAULT -1\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON product TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- 菜品编号 (POS 集成，全局唯一)\nDEFINE FIELD OVERWRITE external_id ON product TYPE option<int>\n    PERMISSIONS FULL;\n\n-- 标签关联\nDEFINE FIELD OVERWRITE tags ON product TYPE array<record<tag>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- 嵌入式规格数组 (文档数据库风格)\nDEFINE FIELD OVERWRITE specs ON product TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- 规格对象字段定义\nDEFINE FIELD OVERWRITE specs.*.name ON product TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.price ON product TYPE float DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.display_order ON product TYPE int DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.is_default ON product TYPE bool DEFAULT false PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.is_active ON product TYPE bool DEFAULT true PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.receipt_name ON product TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.is_root ON product TYPE bool DEFAULT false PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE product_category ON product FIELDS category;\nDEFINE INDEX OVERWRITE product_sort_order ON product FIELDS sort_order;\nDEFINE INDEX OVERWRITE product_external_id ON product FIELDS external_id UNIQUE;\n\n-- Product Spec Index Table (removed: external_id now on product table with UNIQUE index)\nREMOVE TABLE IF EXISTS product_spec;\n\n-- Role Table Schema\n-- 角色表，存储权限角色信息\n\nDEFINE TABLE OVERWRITE role TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON role TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_name ON role TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON role TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE permissions ON role TYPE array<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_system ON role TYPE bool DEFAULT false\n    PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE is_active ON role TYPE bool DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE role_name_unique ON role FIELDS name UNIQUE;\n\n-- Script Migration Table Schema\n-- 迁移记录表，跟踪已执行的数据库迁移\n\nDEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\n\nDEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\n\nDEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n\n-- System State Schema\n-- 系统状态表（哈希链状态缓存，单例）\n\nDEFINE TABLE OVERWRITE system_state TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- 创世哈希\nDEFINE FIELD OVERWRITE genesis_hash ON system_state TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 最后订单\nDEFINE FIELD OVERWRITE last_order ON system_state TYPE option<record<order>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE last_order_hash ON system_state TYPE option<string>\n    PERMISSIONS FULL;\n\n-- 同步状态\nDEFINE FIELD OVERWRITE synced_up_to ON system_state TYPE option<record<order>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE synced_up_to_hash ON system_state TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE last_sync_time ON system_state TYPE option<datetime>\n    PERMISSIONS FULL;\n\n-- 统计\nDEFINE FIELD OVERWRITE order_count ON system_state TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON system_state TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE updated_at ON system_state TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\n-- Tag Table Schema\n-- 标签表，用于给菜品/规格打标签\n\nDEFINE TABLE OVERWRITE tag TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON tag TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE color ON tag TYPE string\n    DEFAULT \"#3B82F6\"\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_order ON tag TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON tag TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- 系统标签 (热卖、新品等)，不可删除\nDEFINE FIELD OVERWRITE is_system ON tag TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE tag_name_unique ON tag FIELDS name UNIQUE;\nDEFINE INDEX OVERWRITE tag_display_order ON tag FIELDS display_order;\n\n-- Zone Schema\n-- 区域表（如：大厅、露台、包厢）\n\nDEFINE TABLE OVERWRITE zone TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON zone TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON zone TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON zone TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE zone_name ON zone FIELDS name;\n", "events": ""}