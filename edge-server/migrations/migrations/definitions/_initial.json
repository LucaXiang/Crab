{"schemas": "-- Attribute Schema (Graph-oriented)\n-- \u5c5e\u6027\u8868\uff0c\u9009\u9879\u76f4\u63a5\u5d4c\u5165\uff0c\u4f7f\u7528 RELATE \u5efa\u7acb\u4e0e\u4ea7\u54c1/\u5206\u7c7b\u7684\u5173\u7cfb\n\nDEFINE TABLE OVERWRITE attribute TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON attribute TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\n-- \u9009\u62e9\u6a21\u5f0f\nDEFINE FIELD OVERWRITE is_multi_select ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- \u591a\u9009\u4e0a\u9650 (null = \u65e0\u9650)\nDEFINE FIELD OVERWRITE max_selections ON attribute TYPE option<int>\n    PERMISSIONS FULL;\n\n-- \u9ed8\u8ba4\u9009\u9879\u7d22\u5f15\nDEFINE FIELD OVERWRITE default_option_idx ON attribute TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_order ON attribute TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON attribute TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE show_on_receipt ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE receipt_name ON attribute TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u53a8\u6253\u8bbe\u7f6e\nDEFINE FIELD OVERWRITE show_on_kitchen_print ON attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE kitchen_print_name ON attribute TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u9009\u9879\u76f4\u63a5\u5d4c\u5165 (Graph DB \u98ce\u683c: \u51cf\u5c11 JOIN)\n-- options: [{ name: \"\u5fae\u8fa3\", price_modifier: 0, kitchen_print_name: null }, ...]\nDEFINE FIELD OVERWRITE options ON attribute TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE attr_order ON attribute FIELDS display_order;\n\n-- =============================================================================\n-- \u8fb9\u5173\u7cfb: has_attribute (\u4ea7\u54c1/\u5206\u7c7b -> \u5c5e\u6027)\n-- =============================================================================\n-- \u4f7f\u7528: RELATE product:1->has_attribute->attribute:spicy SET is_required = true\n-- \u67e5\u8be2: SELECT ->has_attribute->attribute FROM product:1\n\nDEFINE TABLE OVERWRITE has_attribute TYPE RELATION\n    FROM product | category\n    TO attribute\n    SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE is_required ON has_attribute TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_order ON has_attribute TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- \u8986\u76d6\u5c5e\u6027\u7684\u9ed8\u8ba4\u9009\u9879\u7d22\u5f15\nDEFINE FIELD OVERWRITE default_option_idx ON has_attribute TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE has_attr_unique ON has_attribute FIELDS in, out UNIQUE;\n\n-- Audit Log Table Schema\n-- \u5ba1\u8ba1\u65e5\u5fd7\u8868\uff0c\u8bb0\u5f55\u7cfb\u7edf\u64cd\u4f5c\u5386\u53f2\n\nDEFINE TABLE OVERWRITE audit_log TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select WHERE $auth.role = role:admin OR $auth.id = employee:admin\n        FOR create FULL\n        FOR update, delete NONE;\n\n-- \u64cd\u4f5c\u7c7b\u578b\nDEFINE FIELD OVERWRITE action ON audit_log TYPE string\n    ASSERT $value IN [\n        'login', 'logout', 'login_failed', 'token_refresh',\n        'read', 'create', 'update', 'delete',\n        'config_change', 'user_create', 'user_update', 'user_delete',\n        'role_change', 'permission_change',\n        'server_start', 'server_stop', 'backup_create', 'backup_restore',\n        'unauthorized_access', 'invalid_token'\n    ]\n    PERMISSIONS FULL;\n\n-- \u64cd\u4f5c\u8d44\u6e90\nDEFINE FIELD OVERWRITE resource ON audit_log TYPE string\n    PERMISSIONS FULL;\n\n-- \u662f\u5426\u6210\u529f\nDEFINE FIELD OVERWRITE success ON audit_log TYPE bool DEFAULT true\n    PERMISSIONS FULL;\n\n-- \u7528\u6237\u4fe1\u606f\uff08\u53ef\u9009\uff09\nDEFINE FIELD OVERWRITE user_id ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE username ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u8bf7\u6c42\u4e0a\u4e0b\u6587\nDEFINE FIELD OVERWRITE ip_address ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE user_agent ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u8be6\u60c5\nDEFINE FIELD OVERWRITE details ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE error ON audit_log TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u65f6\u95f4\u6233\uff08\u81ea\u52a8\u751f\u6210\uff0c\u53ea\u8bfb\uff09\nDEFINE FIELD OVERWRITE created_at ON audit_log TYPE datetime VALUE time::now() READONLY\n    PERMISSIONS FULL;\n\n-- \u7d22\u5f15\nDEFINE INDEX OVERWRITE audit_action_idx ON audit_log FIELDS action;\nDEFINE INDEX OVERWRITE audit_user_idx ON audit_log FIELDS user_id;\nDEFINE INDEX OVERWRITE audit_resource_idx ON audit_log FIELDS resource;\nDEFINE INDEX OVERWRITE audit_created_idx ON audit_log FIELDS created_at;\nDEFINE INDEX OVERWRITE audit_success_idx ON audit_log FIELDS success;\n\n-- Category Table Schema\n-- \u4ea7\u54c1\u5206\u7c7b\u8868\n\nDEFINE TABLE OVERWRITE category TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON category TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE sort_order ON category TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- \u6253\u5370\u76ee\u7684\u5730\nDEFINE FIELD OVERWRITE print_destinations ON category TYPE array<record<print_destination>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- \u53a8\u623f\u6253\u5370\u5f00\u5173\nDEFINE FIELD OVERWRITE is_kitchen_print_enabled ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- \u6807\u7b7e\u6253\u5370\u5f00\u5173\nDEFINE FIELD OVERWRITE is_label_print_enabled ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- \u865a\u62df\u5206\u7c7b\u652f\u6301\nDEFINE FIELD OVERWRITE is_virtual ON category TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tag_ids ON category TYPE array<record<tag>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE match_mode ON category TYPE string\n    DEFAULT 'any'\n    PERMISSIONS FULL;\n\n-- \u662f\u5426\u5728 POS \u4e3b\u9875\u663e\u793a\u6b64\u5206\u7c7b\nDEFINE FIELD OVERWRITE is_display ON category TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE category_name_unique ON category FIELDS name UNIQUE;\nDEFINE INDEX OVERWRITE category_sort_order ON category FIELDS sort_order;\n\n-- Dining Table Schema\n-- \u684c\u53f0\u8868\n\nDEFINE TABLE OVERWRITE dining_table TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON dining_table TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\n-- \u533a\u57df\u5173\u8054\nDEFINE FIELD OVERWRITE zone ON dining_table TYPE record<zone>\n    PERMISSIONS FULL;\n\n-- \u5ea7\u4f4d\u6570\nDEFINE FIELD OVERWRITE capacity ON dining_table TYPE int\n    DEFAULT 4\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON dining_table TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE table_zone ON dining_table FIELDS zone;\nDEFINE INDEX OVERWRITE table_name_zone ON dining_table FIELDS zone, name UNIQUE;\n\n-- Employee Table Schema\n-- \u5458\u5de5\u8868\uff0c\u5b58\u50a8\u7cfb\u7edf\u7528\u6237\u4fe1\u606f\n\nDEFINE TABLE OVERWRITE employee TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE username ON employee TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE hash_pass ON employee TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_name ON employee TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE role ON employee TYPE record<role>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_system ON employee TYPE bool DEFAULT false\n    PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE is_active ON employee TYPE bool DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE username_unique ON employee FIELDS username UNIQUE;\n\n-- Image Reference Table Schema\n-- \u56fe\u7247\u5f15\u7528\u8ba1\u6570\u8868\uff0c\u7528\u4e8e\u8ddf\u8e2a\u56fe\u7247\u88ab\u54ea\u4e9b\u5b9e\u4f53\u5f15\u7528\n\nDEFINE TABLE OVERWRITE image_ref TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- \u56fe\u7247\u54c8\u5e0c (SHA256 \u5185\u5bb9\u54c8\u5e0c)\nDEFINE FIELD OVERWRITE hash ON image_ref TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\n-- \u5f15\u7528\u5b9e\u4f53\u7c7b\u578b: \"product\", \"label_template\"\nDEFINE FIELD OVERWRITE entity_type ON image_ref TYPE string\n    ASSERT $value IN [\"product\", \"label_template\"]\n    PERMISSIONS FULL;\n\n-- \u5f15\u7528\u5b9e\u4f53 ID (\u683c\u5f0f: \"product:xxx\" \u6216 \"label_template:xxx\")\nDEFINE FIELD OVERWRITE entity_id ON image_ref TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\n-- \u521b\u5efa\u65f6\u95f4\nDEFINE FIELD OVERWRITE created_at ON image_ref TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\n-- \u552f\u4e00\u7d22\u5f15\uff1a\u540c\u4e00\u5b9e\u4f53\u5bf9\u540c\u4e00\u56fe\u7247\u53ea\u8bb0\u5f55\u4e00\u6b21\nDEFINE INDEX OVERWRITE idx_image_ref_unique ON image_ref FIELDS hash, entity_type, entity_id UNIQUE;\n\n-- \u54c8\u5e0c\u7d22\u5f15\uff1a\u5feb\u901f\u67e5\u627e\u56fe\u7247\u7684\u6240\u6709\u5f15\u7528\nDEFINE INDEX OVERWRITE idx_image_ref_hash ON image_ref FIELDS hash;\n\n-- \u5b9e\u4f53\u7d22\u5f15\uff1a\u5feb\u901f\u67e5\u627e\u5b9e\u4f53\u7684\u6240\u6709\u56fe\u7247\u5f15\u7528\nDEFINE INDEX OVERWRITE idx_image_ref_entity ON image_ref FIELDS entity_type, entity_id;\n\n-- Order Schema (Graph Model)\n-- \u5f52\u6863\u8ba2\u5355\u4f7f\u7528\u56fe\u8fb9\u5173\u7cfb\uff0c\u53ea\u5b58\u50a8\u6838\u5fc3\u6570\u636e\n\n-- =============================================================================\n-- order \u8868\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE receipt_number ON order TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE zone_name ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE table_name ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE status ON order TYPE string\n    ASSERT $value IN [\"COMPLETED\", \"VOID\", \"MOVED\", \"MERGED\"]\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_retail ON order TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE guest_count ON order TYPE option<int>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE original_total ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE subtotal ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE total_amount ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE paid_amount ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE discount_amount ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE surcharge_amount ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax ON order TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE start_time ON order TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE end_time ON order TYPE option<datetime>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE operator_id ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE operator_name ON order TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE related_order_id ON order TYPE option<record<order>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE prev_hash ON order TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE curr_hash ON order TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON order TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE order_receipt ON order FIELDS receipt_number UNIQUE;\nDEFINE INDEX OVERWRITE order_status ON order FIELDS status;\nDEFINE INDEX OVERWRITE order_end_time ON order FIELDS end_time;\nDEFINE INDEX OVERWRITE order_hash ON order FIELDS curr_hash;\n\n-- =============================================================================\n-- order_item \u8868\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_item TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE spec ON order_item TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE instance_id ON order_item TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE name ON order_item TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE spec_name ON order_item TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE price ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE quantity ON order_item TYPE int\n    DEFAULT 1\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE unpaid_quantity ON order_item TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE unit_price ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE line_total ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE discount_amount ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE surcharge_amount ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax ON order_item TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE tax_rate ON order_item TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE note ON order_item TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE order_item_spec ON order_item FIELDS spec;\nDEFINE INDEX OVERWRITE order_item_instance ON order_item FIELDS instance_id;\n\n-- =============================================================================\n-- order_item_option \u8868\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_item_option TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE attribute_name ON order_item_option TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE option_name ON order_item_option TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE price ON order_item_option TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- =============================================================================\n-- order_payment \u8868\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_payment TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE method ON order_payment TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE amount ON order_payment TYPE float\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE time ON order_payment TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE reference ON order_payment TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE cancelled ON order_payment TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE cancel_reason ON order_payment TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE split_items ON order_payment TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE payment_method ON order_payment FIELDS method;\nDEFINE INDEX OVERWRITE payment_time ON order_payment FIELDS time;\n\n-- =============================================================================\n-- order_event \u8868\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE order_event TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE event_type ON order_event TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE timestamp ON order_event TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE data ON order_event TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE prev_hash ON order_event TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE curr_hash ON order_event TYPE string\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE event_time ON order_event FIELDS timestamp;\n\n-- =============================================================================\n-- \u56fe\u8fb9\u5173\u7cfb\n-- =============================================================================\n\nDEFINE TABLE OVERWRITE has_item TYPE RELATION\n    FROM order TO order_item SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE TABLE OVERWRITE has_option TYPE RELATION\n    FROM order_item TO order_item_option SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE TABLE OVERWRITE has_payment TYPE RELATION\n    FROM order TO order_payment SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE TABLE OVERWRITE has_event TYPE RELATION\n    FROM order TO order_event SCHEMAFULL\n    PERMISSIONS FOR select, create\n        WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- Price Rule Schema\n-- \u4ef7\u683c\u8c03\u6574\u89c4\u5219\uff08\u6298\u6263/\u9644\u52a0\u8d39\uff09\n\nDEFINE TABLE OVERWRITE price_rule TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON price_rule TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_name ON price_rule TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE receipt_name ON price_rule TYPE string\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON price_rule TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u89c4\u5219\u7c7b\u578b: DISCOUNT, SURCHARGE\nDEFINE FIELD OVERWRITE rule_type ON price_rule TYPE string\n    ASSERT $value IN [\"DISCOUNT\", \"SURCHARGE\"]\n    PERMISSIONS FULL;\n\n-- \u5e94\u7528\u8303\u56f4: GLOBAL, CATEGORY, TAG, PRODUCT\nDEFINE FIELD OVERWRITE product_scope ON price_rule TYPE string\n    ASSERT $value IN [\"GLOBAL\", \"CATEGORY\", \"TAG\", \"PRODUCT\"]\n    PERMISSIONS FULL;\n\n-- \u76ee\u6807 (\u6839\u636e scope): record<category> | record<tag> | record<product> | null\nDEFINE FIELD OVERWRITE target ON price_rule TYPE option<record>\n    PERMISSIONS FULL;\n\n-- \u533a\u57df\u8303\u56f4: \"zone:all\"=\u5168\u90e8, \"zone:retail\"=\u96f6\u552e, \"zone:xxx\"=\u6307\u5b9a\u533a\u57df\nDEFINE FIELD OVERWRITE zone_scope ON price_rule TYPE string\n    DEFAULT \"zone:all\"\n    PERMISSIONS FULL;\n\n-- \u8c03\u6574\u7c7b\u578b: PERCENTAGE, FIXED_AMOUNT\nDEFINE FIELD OVERWRITE adjustment_type ON price_rule TYPE string\n    ASSERT $value IN [\"PERCENTAGE\", \"FIXED_AMOUNT\"]\n    PERMISSIONS FULL;\n\n-- \u8c03\u6574\u503c (\u767e\u5206\u6bd4\u598230=30%, \u56fa\u5b9a\u91d1\u989d\u59820.5)\nDEFINE FIELD OVERWRITE adjustment_value ON price_rule TYPE float\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE priority ON price_rule TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_stackable ON price_rule TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- \u72ec\u5360\u89c4\u5219 (\u4e0d\u80fd\u4e0e\u5176\u4ed6\u89c4\u5219\u53e0\u52a0)\nDEFINE FIELD OVERWRITE is_exclusive ON price_rule TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\n-- \u6709\u6548\u671f\u5f00\u59cb\u65f6\u95f4\nDEFINE FIELD OVERWRITE valid_from ON price_rule TYPE option<datetime>\n    PERMISSIONS FULL;\n\n-- \u6709\u6548\u671f\u7ed3\u675f\u65f6\u95f4\nDEFINE FIELD OVERWRITE valid_until ON price_rule TYPE option<datetime>\n    PERMISSIONS FULL;\n\n-- \u6d3b\u52a8\u65e5 (0=\u5468\u65e5, 1=\u5468\u4e00, ..., 6=\u5468\u516d)\nDEFINE FIELD OVERWRITE active_days ON price_rule TYPE option<array<int>>\n    PERMISSIONS FULL;\n\n-- \u6bcf\u65e5\u5f00\u59cb\u65f6\u95f4 (HH:MM \u683c\u5f0f)\nDEFINE FIELD OVERWRITE active_start_time ON price_rule TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u6bcf\u65e5\u7ed3\u675f\u65f6\u95f4 (HH:MM \u683c\u5f0f)\nDEFINE FIELD OVERWRITE active_end_time ON price_rule TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON price_rule TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_by ON price_rule TYPE option<record<employee>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON price_rule TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE rule_active ON price_rule FIELDS is_active, product_scope;\n\n-- Print Destination Schema\n-- \u6253\u5370\u76ee\u7684\u5730\uff08\u62bd\u8c61\u5c42\uff09\n\nDEFINE TABLE OVERWRITE print_destination TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON print_destination TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON print_destination TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u5d4c\u5165\u5f0f\u6253\u5370\u673a\u914d\u7f6e\nDEFINE FIELD OVERWRITE printers ON print_destination TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- \u6253\u5370\u673a\u5b57\u6bb5\u5b9a\u4e49\nDEFINE FIELD OVERWRITE printers.*.printer_type ON print_destination TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.ip ON print_destination TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.port ON print_destination TYPE option<int> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.driver_name ON print_destination TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.priority ON print_destination TYPE int DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE printers.*.is_active ON print_destination TYPE bool DEFAULT true PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON print_destination TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE print_dest_name ON print_destination FIELDS name UNIQUE;\n\n-- Product Table Schema\n-- \u4ea7\u54c1\u8868\n\nDEFINE TABLE OVERWRITE product TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON product TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE image ON product TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\n-- \u5206\u7c7b\u5173\u8054 (SurrealDB Record Link)\nDEFINE FIELD OVERWRITE category ON product TYPE record<category>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE sort_order ON product TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- \u7a0e\u7387 (\u767e\u5206\u6bd4\uff0c\u5982 10 \u8868\u793a 10%)\nDEFINE FIELD OVERWRITE tax_rate ON product TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- \u5c0f\u7968\u540d\u79f0 (\u53ef\u9009\uff0c\u9ed8\u8ba4\u4f7f\u7528 name)\nDEFINE FIELD OVERWRITE receipt_name ON product TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u53a8\u623f\u6253\u5370\u540d\u79f0\nDEFINE FIELD OVERWRITE kitchen_print_name ON product TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u53a8\u623f\u6253\u5370\u76ee\u7684\u5730\nDEFINE FIELD OVERWRITE kitchen_print_destinations ON product TYPE array<record<print_destination>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- \u6807\u7b7e\u6253\u5370\u76ee\u7684\u5730\nDEFINE FIELD OVERWRITE label_print_destinations ON product TYPE array<record<print_destination>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- \u53a8\u623f\u6253\u5370\u542f\u7528\u72b6\u6001 (-1=\u7ee7\u627f, 0=\u7981\u7528, 1=\u542f\u7528)\nDEFINE FIELD OVERWRITE is_kitchen_print_enabled ON product TYPE int\n    DEFAULT -1\n    PERMISSIONS FULL;\n\n-- \u6807\u7b7e\u6253\u5370\u542f\u7528\u72b6\u6001 (-1=\u7ee7\u627f, 0=\u7981\u7528, 1=\u542f\u7528)\nDEFINE FIELD OVERWRITE is_label_print_enabled ON product TYPE int\n    DEFAULT -1\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON product TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- \u6807\u7b7e\u5173\u8054\nDEFINE FIELD OVERWRITE tags ON product TYPE array<record<tag>>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- \u5d4c\u5165\u5f0f\u89c4\u683c\u6570\u7ec4 (\u6587\u6863\u6570\u636e\u5e93\u98ce\u683c)\nDEFINE FIELD OVERWRITE specs ON product TYPE array<object>\n    DEFAULT []\n    PERMISSIONS FULL;\n\n-- \u89c4\u683c\u5bf9\u8c61\u5b57\u6bb5\u5b9a\u4e49\nDEFINE FIELD OVERWRITE specs.*.name ON product TYPE string PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.price ON product TYPE float DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.display_order ON product TYPE int DEFAULT 0 PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.is_default ON product TYPE bool DEFAULT false PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.is_active ON product TYPE bool DEFAULT true PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.external_id ON product TYPE option<int> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.receipt_name ON product TYPE option<string> PERMISSIONS FULL;\nDEFINE FIELD OVERWRITE specs.*.is_root ON product TYPE bool DEFAULT false PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE product_category ON product FIELDS category;\nDEFINE INDEX OVERWRITE product_sort_order ON product FIELDS sort_order;\nDEFINE INDEX OVERWRITE product_external_id ON product FIELDS specs[*].external_id;\n\n-- Product Spec Index Table\n-- \u6241\u5e73\u5316\u5b58\u50a8 product specs \u7684 external_id\uff0c\u7528\u4e8e\u552f\u4e00\u6027\u7ea6\u675f\n-- \u5f53\u521b\u5efa/\u66f4\u65b0\u4ea7\u54c1\u65f6\u540c\u6b65\u7ef4\u62a4\n\nDEFINE TABLE OVERWRITE product_spec TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- \u5173\u8054\u7684\u4ea7\u54c1\nDEFINE FIELD OVERWRITE product ON product_spec TYPE record<product>\n    PERMISSIONS FULL;\n\n-- \u89c4\u683c\u5728 specs \u6570\u7ec4\u4e2d\u7684\u7d22\u5f15\nDEFINE FIELD OVERWRITE spec_index ON product_spec TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\n-- \u5916\u90e8 ID (\u7528\u4e8e POS \u7cfb\u7edf\u96c6\u6210)\nDEFINE FIELD OVERWRITE external_id ON product_spec TYPE int\n    PERMISSIONS FULL;\n\n-- \u552f\u4e00\u6027\u7ea6\u675f\uff1aexternal_id \u5168\u5c40\u552f\u4e00\nDEFINE INDEX OVERWRITE unique_external_id ON product_spec FIELDS external_id UNIQUE;\n\n-- \u4ea7\u54c1\u7d22\u5f15\uff1a\u5feb\u901f\u67e5\u627e\u4ea7\u54c1\u7684\u6240\u6709 specs\nDEFINE INDEX OVERWRITE product_spec_product ON product_spec FIELDS product;\n\n-- Role Table Schema\n-- \u89d2\u8272\u8868\uff0c\u5b58\u50a8\u6743\u9650\u89d2\u8272\u4fe1\u606f\n\nDEFINE TABLE OVERWRITE role TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON role TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_name ON role TYPE string\n    DEFAULT \"\"\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON role TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE permissions ON role TYPE array<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_system ON role TYPE bool DEFAULT false\n    PERMISSIONS NONE;\n\nDEFINE FIELD OVERWRITE is_active ON role TYPE bool DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE role_name_unique ON role FIELDS name UNIQUE;\n\n-- Script Migration Table Schema\n-- \u8fc1\u79fb\u8bb0\u5f55\u8868\uff0c\u8ddf\u8e2a\u5df2\u6267\u884c\u7684\u6570\u636e\u5e93\u8fc1\u79fb\n\nDEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\n\nDEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\n\nDEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n\n-- System State Schema\n-- \u7cfb\u7edf\u72b6\u6001\u8868\uff08\u54c8\u5e0c\u94fe\u72b6\u6001\u7f13\u5b58\uff0c\u5355\u4f8b\uff09\n\nDEFINE TABLE OVERWRITE system_state TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\n-- \u521b\u4e16\u54c8\u5e0c\nDEFINE FIELD OVERWRITE genesis_hash ON system_state TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u6700\u540e\u8ba2\u5355\nDEFINE FIELD OVERWRITE last_order ON system_state TYPE option<record<order>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE last_order_hash ON system_state TYPE option<string>\n    PERMISSIONS FULL;\n\n-- \u540c\u6b65\u72b6\u6001\nDEFINE FIELD OVERWRITE synced_up_to ON system_state TYPE option<record<order>>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE synced_up_to_hash ON system_state TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE last_sync_time ON system_state TYPE option<datetime>\n    PERMISSIONS FULL;\n\n-- \u7edf\u8ba1\nDEFINE FIELD OVERWRITE order_count ON system_state TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE created_at ON system_state TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE updated_at ON system_state TYPE datetime\n    DEFAULT time::now()\n    PERMISSIONS FULL;\n\n-- Tag Table Schema\n-- \u6807\u7b7e\u8868\uff0c\u7528\u4e8e\u7ed9\u83dc\u54c1/\u89c4\u683c\u6253\u6807\u7b7e\n\nDEFINE TABLE OVERWRITE tag TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON tag TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE color ON tag TYPE string\n    DEFAULT \"#3B82F6\"\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE display_order ON tag TYPE int\n    DEFAULT 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON tag TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\n-- \u7cfb\u7edf\u6807\u7b7e (\u70ed\u5356\u3001\u65b0\u54c1\u7b49)\uff0c\u4e0d\u53ef\u5220\u9664\nDEFINE FIELD OVERWRITE is_system ON tag TYPE bool\n    DEFAULT false\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE tag_name_unique ON tag FIELDS name UNIQUE;\nDEFINE INDEX OVERWRITE tag_display_order ON tag FIELDS display_order;\n\n-- Zone Schema\n-- \u533a\u57df\u8868\uff08\u5982\uff1a\u5927\u5385\u3001\u9732\u53f0\u3001\u5305\u53a2\uff09\n\nDEFINE TABLE OVERWRITE zone TYPE NORMAL SCHEMAFULL\n    PERMISSIONS\n        FOR select, create, update, delete\n            WHERE $auth.role = role:admin OR $auth.id = employee:admin;\n\nDEFINE FIELD OVERWRITE name ON zone TYPE string\n    ASSERT string::len($value) > 0\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE description ON zone TYPE option<string>\n    PERMISSIONS FULL;\n\nDEFINE FIELD OVERWRITE is_active ON zone TYPE bool\n    DEFAULT true\n    PERMISSIONS FULL;\n\nDEFINE INDEX OVERWRITE zone_name ON zone FIELDS name;\n", "events": ""}