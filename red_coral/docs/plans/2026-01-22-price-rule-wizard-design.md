# 价格规则创建向导设计

> **目标**: 简化复杂的价格规则创建流程，通过 6 步向导引导用户完成配置

## 设计原则

1. **复用现有组件**: FormSection, FormField, CheckboxField, SubField
2. **保持视觉一致**: teal 主色调, rounded-xl 圆角, 相同的 Modal 结构
3. **渐进式披露**: 每步只显示相关选项，避免信息过载

## 向导步骤

```
┌─────────────────────────────────────────────────────────────┐
│  ● ─ ○ ─ ○ ─ ○ ─ ○ ─ ○   创建价格规则                    X │
│  1   2   3   4   5   6                                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📊 选择规则类型                                      │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │  ┌──────────────┐    ┌──────────────┐              │   │
│  │  │    💰        │    │    💸        │              │   │
│  │  │   折扣       │    │   附加费     │              │   │
│  │  │  打折促销    │    │  加价收费    │              │   │
│  │  │  ○ 选择      │    │  ○ 选择      │              │   │
│  │  └──────────────┘    └──────────────┘              │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                           [取消]  [下一步 →]                │
└─────────────────────────────────────────────────────────────┘
```

### 步骤 1: 规则类型

**目的**: 确定是折扣还是附加费

```tsx
// 大卡片选择，视觉突出
<div className="grid grid-cols-2 gap-4">
  <TypeCard
    icon={<Percent />}
    title="折扣"
    description="对商品价格进行打折"
    selected={type === 'DISCOUNT'}
    onClick={() => setType('DISCOUNT')}
  />
  <TypeCard
    icon={<Plus />}
    title="附加费"
    description="在商品价格基础上加收费用"
    selected={type === 'SURCHARGE'}
    onClick={() => setType('SURCHARGE')}
  />
</div>
```

### 步骤 2: 调整方式

**目的**: 确定计算方式和数值

```
┌─────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 🧮 设置调整方式                                      │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │  调整方式                                           │   │
│  │  ┌──────────────┐    ┌──────────────┐              │   │
│  │  │     %        │    │     ¥        │              │   │
│  │  │  按百分比    │    │  固定金额    │              │   │
│  │  │  ● 选择      │    │  ○ 选择      │              │   │
│  │  └──────────────┘    └──────────────┘              │   │
│  │                                                     │   │
│  │  折扣比例 *                                         │   │
│  │  ┌─────────────────────────────────────┬─────┐     │   │
│  │  │ 10                                  │  %  │     │   │
│  │  └─────────────────────────────────────┴─────┘     │   │
│  │  输入 1-100 的数值                                  │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 步骤 3: 作用范围

**目的**: 确定规则应用于哪些商品和区域

```
┌─────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 🎯 选择作用范围                                      │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │  商品范围 *                                         │   │
│  │  ○ 所有商品                                         │   │
│  │  ○ 指定分类  →  [分类选择器]                        │   │
│  │  ○ 指定标签  →  [标签选择器]                        │   │
│  │  ○ 指定商品  →  [商品选择器]                        │   │
│  │                                                     │   │
│  │  区域范围                                           │   │
│  │  ○ 所有区域（堂食+零售）                            │   │
│  │  ○ 仅零售订单                                       │   │
│  │  ○ 指定区域  →  [区域选择器]                        │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 步骤 4: 时间条件

**目的**: 设置规则生效时间（三选一互斥）

```
┌─────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 🕐 设置时间条件                                      │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │  ● 始终生效                                         │   │
│  │    规则将一直有效                                   │   │
│  │                                                     │   │
│  │  ○ 周期性生效                                       │   │
│  │    └─ 每周固定时段生效                              │   │
│  │       ├─ 周几: □一 □二 □三 □四 □五 □六 □日          │   │
│  │       ├─ 开始时间: [11:00]                          │   │
│  │       └─ 结束时间: [14:00]                          │   │
│  │                                                     │   │
│  │  ○ 一次性活动                                       │   │
│  │    └─ 指定时间范围内有效                            │   │
│  │       ├─ 开始: [2026-01-22 00:00]                   │   │
│  │       └─ 结束: [2026-01-31 23:59]                   │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 步骤 5: 命名与摘要

**目的**: 设置规则名称，预览配置

```
┌─────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📝 命名规则                                          │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │  规则名称 *        (系统内部标识)                   │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │ lunch_discount                              │   │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  │                                                     │   │
│  │  显示名称 *        (界面显示)                       │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │ 午餐特惠                                    │   │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  │                                                     │   │
│  │  小票名称 *        (打印在小票上)                   │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │ 午餐                                        │   │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  │                                                     │   │
│  │  描述              (可选)                           │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │ 工作日午餐时段全场9折                       │   │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📋 规则摘要                                          │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │  类型: 折扣 - 百分比 10%                            │   │
│  │  范围: 所有商品 / 所有区域                          │   │
│  │  时间: 周一至周五 11:00-14:00                       │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 步骤 6: 高级设置（可跳过）

**目的**: 配置优先级和叠加规则

```
┌─────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ⚙️ 高级设置（可选）                                  │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │  优先级                                             │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │ 0                                           │   │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  │  数值越大优先级越高，默认 0                         │   │
│  │                                                     │   │
│  │  ☑ 允许叠加                                         │   │
│  │    此规则可以与其他规则同时生效                     │   │
│  │                                                     │   │
│  │  ☐ 独占规则                                         │   │
│  │    如果此规则生效，其他规则将被忽略                 │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│                      [← 上一步]  [跳过并创建]  [创建规则]   │
└─────────────────────────────────────────────────────────────┘
```

## 组件结构

```
PriceRuleWizard/
├── index.tsx                 # 主向导组件
├── WizardProgress.tsx        # 步骤进度指示器
├── steps/
│   ├── Step1RuleType.tsx     # 规则类型选择
│   ├── Step2Adjustment.tsx   # 调整方式设置
│   ├── Step3Scope.tsx        # 作用范围选择
│   ├── Step4Time.tsx         # 时间条件设置
│   ├── Step5Naming.tsx       # 命名与摘要
│   └── Step6Advanced.tsx     # 高级设置
├── components/
│   ├── TypeCard.tsx          # 大卡片选择组件
│   ├── RadioGroup.tsx        # 单选组（复用现有样式）
│   ├── DayPicker.tsx         # 周几选择器
│   ├── TimePicker.tsx        # 时间选择器
│   └── RuleSummary.tsx       # 规则摘要预览
└── hooks/
    └── useWizardState.ts     # 向导状态管理
```

## 状态管理

```typescript
interface WizardState {
  currentStep: number;

  // Step 1: 规则类型
  ruleType: 'DISCOUNT' | 'SURCHARGE';

  // Step 2: 调整方式
  adjustmentType: 'PERCENTAGE' | 'FIXED_AMOUNT';
  adjustmentValue: number;

  // Step 3: 作用范围
  productScope: 'GLOBAL' | 'CATEGORY' | 'TAG' | 'PRODUCT';
  target: string | null;
  zoneScope: number; // -1=全部, 0=零售, >0=指定区域

  // Step 4: 时间条件
  timeMode: 'ALWAYS' | 'SCHEDULE' | 'ONETIME';
  activeDays: number[];
  activeStartTime: string;
  activeEndTime: string;
  validFrom: Date | null;
  validUntil: Date | null;

  // Step 5: 命名
  name: string;
  displayName: string;
  receiptName: string;
  description: string;

  // Step 6: 高级设置
  priority: number;
  isStackable: boolean;
  isExclusive: boolean;
}
```

## 验证规则

| 步骤 | 验证条件 |
|------|----------|
| 1 | ruleType 必选 |
| 2 | adjustmentValue > 0; 百分比 ≤ 100 |
| 3 | productScope 必选; 非 GLOBAL 时 target 必填 |
| 4 | SCHEDULE 时 activeDays.length > 0; ONETIME 时 validFrom/Until 必填 |
| 5 | name, displayName, receiptName 必填 |
| 6 | 无必填，可跳过 |

## 导航逻辑

- **下一步**: 验证当前步骤 → 通过则前进
- **上一步**: 直接返回（保留数据）
- **跳过**: 仅步骤 6 可用，使用默认值创建
- **取消**: 确认对话框 → 丢弃数据

## i18n 键值

```
settings.price_rule.wizard.title
settings.price_rule.wizard.step1_title
settings.price_rule.wizard.step1_discount
settings.price_rule.wizard.step1_discount_desc
settings.price_rule.wizard.step1_surcharge
settings.price_rule.wizard.step1_surcharge_desc
// ... 其他步骤
settings.price_rule.wizard.next
settings.price_rule.wizard.prev
settings.price_rule.wizard.skip_create
settings.price_rule.wizard.create
```

## 实现顺序

1. 添加 Tauri 命令: create_price_rule, update_price_rule
2. 添加 TypeScript 客户端方法
3. 创建 WizardProgress 组件
4. 逐步实现 Step1-6 组件
5. 组装 PriceRuleWizard 主组件
6. 集成到 Settings 页面
7. 添加 i18n 翻译
